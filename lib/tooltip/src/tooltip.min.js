"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=require("../../hooks/size"),_utils=require("../../tools/utils"),_dom=require("../../tools/dom");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},_default2=(0,_vue.defineComponent)({name:"VxeTooltip",props:{modelValue:Boolean,size:{type:String,default:function(){return _conf.default.tooltip.size||_conf.default.size}},trigger:{type:String,default:function(){return _conf.default.tooltip.trigger}},theme:{type:String,default:function(){return _conf.default.tooltip.theme}},content:[String,Number],zIndex:[String,Number],isArrow:{type:Boolean,default:!0},enterable:Boolean,leaveDelay:{type:Number,default:function(){return _conf.default.tooltip.leaveDelay}},leaveMethod:Function},emits:["update:modelValue"],setup:function(c,e){var r,f=e.slots,o=e.emit,t=_xeUtils.default.uniqueId(),p=(0,_size.useSize)(c),v=(0,_vue.reactive)({target:null,isUpdate:!1,isHover:!1,visible:!1,message:"",tipTarget:null,tipZindex:0,tipStore:{style:{},placement:"",arrowStyle:{}}}),m=(0,_vue.ref)(),n={refElem:m},i={xID:t,props:c,context:e,reactData:v,getRefMaps:function(){return n}},l={},u=function(){var e=v.tipTarget,t=v.tipStore;if(e){var n=(0,_dom.getDomNode)(),o=n.scrollTop,i=n.scrollLeft,r=n.visibleWidth,l=(0,_dom.getAbsolutePos)(e),u=l.top,a=l.left,s=m.value,c=s.offsetHeight,f=s.offsetWidth,p=a,d=u-c-6;i+r<(p=Math.max(6,a+Math.floor((e.offsetWidth-f)/2)))+f+6&&(p=i+r-f-6),u-c<o+6&&(t.placement="bottom",d=u+e.offsetHeight+6),t.style.top=d+"px",t.style.left=p+"px",t.arrowStyle.left=a-p+e.offsetWidth/2+"px"}},a=function(e){e!==v.visible&&(v.visible=e,v.isUpdate=!0,o("update:modelValue",e))},s=function(){v.visible?l.close():l.open()},d=function(){l.open()},_=function(){var e=c.trigger,t=c.enterable,n=c.leaveDelay;r=!1,t&&"hover"===e?setTimeout(function(){v.isHover||l.close()},n):l.close()},g=function(){v.isHover=!0},h=function(e){var t=c.leaveMethod,n=c.trigger,o=c.enterable,i=c.leaveDelay;v.isHover=!1,t&&!1===t({$event:e})||o&&"hover"===n&&setTimeout(function(){r||l.close()},i)};l={dispatchEvent:function(e,t,n){o(e,Object.assign({$tooltip:i,$event:n},t))},open:function(e,t){return l.toVisible(e||v.target,t)},close:function(){return v.tipTarget=null,Object.assign(v.tipStore,{style:{},placement:"",arrowStyle:null}),a(!1),(0,_vue.nextTick)()},toVisible:function(e,t){if(r=!0,e){var n=v.tipStore,o=m.value;return o.parentNode||document.body.appendChild(o),t&&(v.message=t),v.tipTarget=e,a(!0),v.tipZindex<(0,_utils.getLastZIndex)()&&(v.tipZindex=(0,_utils.nextZIndex)()),n.placement="top",n.style={width:"auto",left:0,top:0,zIndex:c.zIndex||v.tipZindex},n.arrowStyle={left:"50%"},l.updatePlacement()}return(0,_vue.nextTick)()},updatePlacement:function(){return(0,_vue.nextTick)().then(function(){var e=v.tipTarget,t=m.value;if(e&&t)return u(),(0,_vue.nextTick)().then(u)})}},Object.assign(i,l),(0,_vue.watch)(function(){return c.content},function(){v.message=c.content}),(0,_vue.watch)(function(){return c.modelValue},function(){v.isUpdate||(c.modelValue?l.open():l.close()),v.isUpdate=!1}),(0,_vue.onMounted)(function(){(0,_vue.nextTick)(function(){var e=c.trigger,t=c.content,n=c.modelValue,o=m.value,i=o.parentNode;if(i){v.message=t,v.tipZindex=(0,_utils.nextZIndex)(),_xeUtils.default.arrayEach(o.children,function(e,t){1<t&&(i.insertBefore(e,o),v.target||(v.target=e))}),i.removeChild(o);var r=v.target;r&&("hover"===e?(r.onmouseleave=_,r.onmouseenter=d):"click"===e&&(r.onclick=s)),n&&l.open()}})}),(0,_vue.onBeforeUnmount)(function(){var e=c.trigger,t=v.target,n=m.value;if(n){var o=n.parentNode;o&&o.removeChild(n)}t&&("hover"===e?(t.onmouseenter=null,t.onmouseleave=null):"click"===e&&(t.onclick=null))});return i.renderVN=function(){var e,t,n=c.theme,o=c.isArrow,i=c.enterable,r=v.isHover,l=v.visible,u=v.tipStore,a=v.message,s=p.value;return i&&(t={onMouseenter:g,onMouseleave:h}),(0,_vue.h)("div",__assign({ref:m,class:["vxe-table--tooltip-wrapper","theme--"+n,(e={},e["size--"+s]=s,e["placement--"+u.placement]=u.placement,e["is--enterable"]=i,e["is--visible"]=l,e["is--arrow"]=o,e["is--hover"]=r,e)],style:u.style},t),[(0,_vue.h)("div",{class:"vxe-table--tooltip-content"},f.content?f.content({}):(0,_utils.formatText)(a)),(0,_vue.h)("div",{class:"vxe-table--tooltip-arrow",style:u.arrowStyle})].concat(f.default?f.default({}):[]))},i},render:function(){return this.renderVN()}});exports.default=_default2;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=require("../../hooks/size"),_utils=require("../../tools/utils"),_dom=require("../../tools/dom"),_event=require("../../tools/event");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var yearSize=20,monthSize=20,quarterSize=8;function toStringTimeDate(e){if(e){var t=new Date,a=0,n=0,u=0;if(_xeUtils.default.isDate(e))a=e.getHours(),n=e.getMinutes(),u=e.getSeconds();else{var i=(e=_xeUtils.default.toValueString(e)).match(/^(\d{1,2})(:(\d{1,2}))?(:(\d{1,2}))?/);i&&(a=_xeUtils.default.toNumber(i[1]),n=_xeUtils.default.toNumber(i[3]),u=_xeUtils.default.toNumber(i[5]))}return t.setHours(a),t.setMinutes(n),t.setSeconds(u),t}return new Date("")}var _default2=(0,_vue.defineComponent)({name:"VxeInput",props:{modelValue:[String,Number,Date],immediate:{type:Boolean,default:!0},name:String,type:{type:String,default:"text"},clearable:{type:Boolean,default:function(){return _conf.default.input.clearable}},readonly:Boolean,disabled:Boolean,placeholder:String,maxlength:[String,Number],autocomplete:{type:String,default:"off"},align:String,form:String,className:String,size:{type:String,default:function(){return _conf.default.input.size||_conf.default.size}},min:{type:[String,Number],default:null},max:{type:[String,Number],default:null},step:[String,Number],exponential:{type:Boolean,default:function(){return _conf.default.input.exponential}},controls:{type:Boolean,default:function(){return _conf.default.input.controls}},digits:{type:[String,Number],default:function(){return _conf.default.input.digits}},minDate:{type:[String,Number,Date],default:function(){return _conf.default.input.minDate}},maxDate:{type:[String,Number,Date],default:function(){return _conf.default.input.maxDate}},startWeek:Number,startDay:{type:[String,Number],default:function(){return _conf.default.input.startDay}},labelFormat:{type:String,default:function(){return _conf.default.input.labelFormat}},valueFormat:{type:String,default:function(){return _conf.default.input.valueFormat}},editable:{type:Boolean,default:!0},festivalMethod:{type:Function,default:function(){return _conf.default.input.festivalMethod}},disabledMethod:{type:Function,default:function(){return _conf.default.input.disabledMethod}},selectDay:{type:[String,Number],default:function(){return _conf.default.input.selectDay}},prefixIcon:String,suffixIcon:String,placement:String,transfer:{type:Boolean,default:function(){return _conf.default.input.transfer}}},emits:["update:modelValue","input","change","keydown","keyup","wheel","click","focus","blur","clear","search-click","toggle-visible","prev-number","next-number","prefix-click","suffix-click","date-prev","date-today","date-next"],setup:function(F,e){var I=e.slots,n=e.emit,t=_xeUtils.default.uniqueId(),O=(0,_size.useSize)(F),H=(0,_vue.reactive)({inited:!1,panelIndex:0,showPwd:!1,visiblePanel:!1,animatVisible:!1,panelStyle:null,panelPlacement:"",isActivated:!1,inputValue:F.modelValue,datetimePanelValue:null,datePanelValue:null,datePanelLabel:"",datePanelType:"day",selectMonth:null,currentDate:null}),z=(0,_vue.ref)(),L=(0,_vue.ref)(),G=(0,_vue.ref)(),l=(0,_vue.ref)(),a={refElem:z,refInput:L},v={xID:t,props:F,context:e,reactData:H,getRefMaps:function(){return a}},u={},r=(0,_vue.computed)(function(){var e=F.type;return"time"===e||"datetime"===e}),p=(0,_vue.computed)(function(){return-1<["number","integer","float"].indexOf(F.type)}),B=(0,_vue.computed)(function(){return r.value||-1<["date","week","month","quarter","year"].indexOf(F.type)}),s=(0,_vue.computed)(function(){return"password"===F.type}),o=(0,_vue.computed)(function(){return"search"===F.type}),d=(0,_vue.computed)(function(){return _xeUtils.default.toInteger(F.digits)||1}),c=(0,_vue.computed)(function(){var e=F.type,t=d.value,a=F.step;return"integer"===e?_xeUtils.default.toInteger(a)||1:"float"===e?_xeUtils.default.toNumber(a)||1/Math.pow(10,t):_xeUtils.default.toNumber(a)||1}),Q=(0,_vue.computed)(function(){var e=F.type,t=p.value,a=B.value,n=s.value;return F.clearable&&(n||t||a||"text"===e||"search"===e)}),i=(0,_vue.computed)(function(){return F.minDate?_xeUtils.default.toStringDate(F.minDate):null}),f=(0,_vue.computed)(function(){return F.maxDate?_xeUtils.default.toStringDate(F.maxDate):null}),_=(0,_vue.computed)(function(){var e=F.type;return"time"===e?"HH:mm:ss":F.valueFormat||("datetime"===e?"yyyy-MM-dd HH:mm:ss":"yyyy-MM-dd")}),S=(0,_vue.computed)(function(){var e=F.modelValue,t=F.type,a=B.value,n=_.value,u=null;if(e&&a){var i=void 0;i="time"===t?toStringTimeDate(e):_xeUtils.default.toStringDate(e,n),_xeUtils.default.isValidDate(i)&&(u=i)}return u}),h=(0,_vue.computed)(function(){var e=i.value,t=H.selectMonth;return!(!t||!e)&&t<=e}),x=(0,_vue.computed)(function(){var e=f.value,t=H.selectMonth;return!(!t||!e)&&e<=t}),m=(0,_vue.computed)(function(){var e=H.datetimePanelValue;return e?_xeUtils.default.toDateString(e,"HH:mm:ss"):""}),y=(0,_vue.computed)(function(){var e=S.value,t=r.value;return e&&t?1e3*(3600*e.getHours()+60*e.getMinutes()+e.getSeconds()):0}),g=(0,_vue.computed)(function(){return B.value?F.labelFormat||_conf.default.i18n("vxe.input.date.labelFormat."+F.type):null}),b=(0,_vue.computed)(function(){var e=H.selectMonth,t=H.currentDate,a=[];if(e&&t)for(var n=t.getFullYear(),u=new Date(_xeUtils.default.toNumber((""+e.getFullYear()).replace(/\d{1}$/,"0")),0,1),i=-10;i<yearSize-10;i++){var l=_xeUtils.default.getWhatYear(u,i,"first"),r=l.getFullYear();a.push({date:l,isCurrent:!0,isNow:n===r,year:r})}return a}),U=(0,_vue.computed)(function(){if(B.value){var e=H.datePanelType,t=H.selectMonth,a=b.value,n="",u=void 0;return t&&(n=t.getFullYear(),u=t.getMonth()+1),"quarter"===e?_conf.default.i18n("vxe.input.date.quarterLabel",[n]):"month"===e?_conf.default.i18n("vxe.input.date.monthLabel",[n]):"year"===e?a.length?a[0].year+" - "+a[a.length-1].year:"":_conf.default.i18n("vxe.input.date.dayLabel",[n,u?_conf.default.i18n("vxe.input.date.m"+u):"-"])}return""}),E=(0,_vue.computed)(function(){var e=[];if(B.value){var t=F.startDay,a=F.startWeek,n=_xeUtils.default.toNumber(_xeUtils.default.isNumber(t)||_xeUtils.default.isString(t)?t:a);e.push(n);for(var u=0;u<6;u++)6<=n?n=0:n++,e.push(n)}return e}),D=(0,_vue.computed)(function(){return B.value?E.value.map(function(e){return{value:e,label:_conf.default.i18n("vxe.input.date.weeks.w"+e)}}):[]}),P=(0,_vue.computed)(function(){if(B.value){var e=D.value;return[{label:_conf.default.i18n("vxe.input.date.weeks.w")}].concat(e)}return[]}),w=(0,_vue.computed)(function(){var e=b.value;return _xeUtils.default.chunk(e,4)}),N=function(e){var t=e.getMonth();return t<3?1:t<6?2:t<9?3:4},T=(0,_vue.computed)(function(){var e=H.selectMonth,t=H.currentDate,a=[];if(e&&t)for(var n=t.getFullYear(),u=N(t),i=_xeUtils.default.getWhatYear(e,0,"first"),l=i.getFullYear(),r=-2;r<quarterSize-2;r++){var s=_xeUtils.default.getWhatQuarter(i,r),o=s.getFullYear(),v=N(s),d=o<l;a.push({date:s,isPrev:d,isCurrent:o===l,isNow:o===n&&v===u,isNext:!d&&l<o,quarter:v})}return a}),V=(0,_vue.computed)(function(){var e=T.value;return _xeUtils.default.chunk(e,2)}),k=(0,_vue.computed)(function(){var e=H.selectMonth,t=H.currentDate,a=[];if(e&&t)for(var n=t.getFullYear(),u=t.getMonth(),i=_xeUtils.default.getWhatYear(e,0,"first").getFullYear(),l=-4;l<monthSize-4;l++){var r=_xeUtils.default.getWhatYear(e,0,l),s=r.getFullYear(),o=r.getMonth(),v=s<i;a.push({date:r,isPrev:v,isCurrent:s===i,isNow:s===n&&o===u,isNext:!v&&i<s,month:o})}return a}),M=(0,_vue.computed)(function(){var e=k.value;return _xeUtils.default.chunk(e,4)}),W=(0,_vue.computed)(function(){var e=H.selectMonth,t=H.currentDate,a=[];if(e&&t)for(var n=y.value,u=E.value,i=t.getFullYear(),l=t.getMonth(),r=t.getDate(),s=e.getFullYear(),o=e.getMonth(),v=e.getDay(),d=-u.indexOf(v),c=new Date(_xeUtils.default.getWhatDay(e,d).getTime()+n),f=0;f<42;f++){var p=_xeUtils.default.getWhatDay(c,f),_=p.getFullYear(),h=p.getMonth(),x=p.getDate(),m=p<e;a.push({date:p,isPrev:m,isCurrent:_===s&&h===o,isNow:_===i&&h===l&&x===r,isNext:!m&&o!==h,label:x})}return a}),Y=(0,_vue.computed)(function(){var e=W.value;return _xeUtils.default.chunk(e,7)}),K=(0,_vue.computed)(function(){return Y.value.map(function(e){var t=e[0];return[{date:t.date,isWeekNumber:!0,isPrev:!1,isCurrent:!1,isNow:!1,isNext:!1,label:_xeUtils.default.getYearWeek(t.date)}].concat(e)})}),C=(0,_vue.computed)(function(){var e=[];if(r.value)for(var t=0;t<24;t++)e.push({value:t,label:(""+t).padStart(2,"0")});return e}),A=(0,_vue.computed)(function(){var e=[];if(r.value)for(var t=0;t<60;t++)e.push({value:t,label:(""+t).padStart(2,"0")});return e}),q=(0,_vue.computed)(function(){return A.value}),$=(0,_vue.computed)(function(){var e=F.type,t=F.readonly,a=F.editable;return t||!a||"week"===e||"quarter"===e}),j=(0,_vue.computed)(function(){var e=F.type,t=H.showPwd,a=p.value,n=B.value,u=s.value;return n||a||u&&t||"number"===e?"text":e}),Z=(0,_vue.computed)(function(){var e=F.placeholder;return e?(0,_utils.getFuncText)(e):""}),X=(0,_vue.computed)(function(){var e=F.maxlength;return p.value&&!_xeUtils.default.toNumber(e)?16:e}),R=(0,_vue.computed)(function(){var e=F.type;return F.immediate||!("text"===e||"number"===e||"integer"===e||"float"===e)});function J(e){var t=F.type,a=F.exponential,n=X.value,u=d.value,i="float"===t?_xeUtils.default.toFixed(_xeUtils.default.floor(e,u),u):_xeUtils.default.toValueString(e);return!a||e!==i&&_xeUtils.default.toValueString(e).toLowerCase()!==_xeUtils.default.toNumber(i).toExponential()?i.slice(0,n):e}var ee,te,ae=function(e){var t=H.inputValue;u.dispatchEvent(e.type,{value:t},e)},ne=function(e,t){H.inputValue=e,n("update:modelValue",e),u.dispatchEvent("input",{value:e},t),_xeUtils.default.toValueString(F.modelValue)!==e&&u.dispatchEvent("change",{value:e},t)},ue=function(e,t){var a=B.value,n=R.value;H.inputValue=e,a||(n?ne(e,t):u.dispatchEvent("input",{value:e},t))},ie=function(e){var t=e.target.value;ue(t,e)},le=function(e){R.value||ae(e)},re=function(e){H.isActivated=!0,ae(e)},se=function(e){if(!F.disabled){var t=H.inputValue;u.dispatchEvent("prefix-click",{value:t},e)}},oe=function(){H.visiblePanel=!1,ee=window.setTimeout(function(){H.animatVisible=!1},350)},ve=function(e,t){var a=F.type,n=p.value;B.value&&oe(),(n||-1<["text","search","password"].indexOf(a))&&focus(),u.dispatchEvent("clear",{value:t},e)},de=function(e){if(!F.disabled)if((0,_dom.hasClass)(e.currentTarget,"is--clear"))ne("",e),ve(e,"");else{var t=H.inputValue;u.dispatchEvent("suffix-click",{value:t},e)}},ce=function(e){var t=F.type,a=F.valueFormat,n=g.value,u=null,i="";e&&(u="time"===t?toStringTimeDate(e):_xeUtils.default.toStringDate(e,a)),_xeUtils.default.isValidDate(u)?i=_xeUtils.default.toDateString(u,n):u=null,H.datePanelValue=u,H.datePanelLabel=i},fe=function(){var e=B.value,t=H.inputValue;e&&(ce(t),H.inputValue=H.datePanelLabel)},pe=function(e){return null===F.max||_xeUtils.default.toNumber(e)<=_xeUtils.default.toNumber(F.max)},_e=function(e){return null===F.min||_xeUtils.default.toNumber(e)>=_xeUtils.default.toNumber(F.min)},he=function(e){var t=_xeUtils.default.getWhatMonth(e,0,"first");_xeUtils.default.isEqual(t,H.selectMonth)||(H.selectMonth=t)},xe=function(e){var t=F.modelValue,a=H.datetimePanelValue,n=r.value,u=_.value;if("week"===F.type){var i=_xeUtils.default.toNumber(F.selectDay);e=_xeUtils.default.getWhatWeek(e,0,i)}else n&&(e.setHours(a.getHours()),e.setMinutes(a.getMinutes()),e.setSeconds(a.getSeconds()));var l=_xeUtils.default.toDateString(e,u);he(e),_xeUtils.default.isEqual(t,l)||ne(l,{type:"update"})},me=function(){var e=F.type,t=F.min,a=F.max,n=F.exponential,u=H.inputValue,i=H.datetimePanelValue,l=p.value,r=B.value,s=g.value;if(!$.value)if(l){if(u){var o="integer"===e?_xeUtils.default.toInteger(u):_xeUtils.default.toNumber(u);if(_e(o)?pe(o)||(o=a):o=t,n){var v=_xeUtils.default.toValueString(u).toLowerCase();v===_xeUtils.default.toNumber(o).toExponential()&&(o=v)}ne(J(o),{type:"check"})}}else if(r)if(u){var d=void 0;if(d="time"===e?toStringTimeDate(u):_xeUtils.default.toStringDate(u,s),_xeUtils.default.isValidDate(d))if("time"===e)u!==(d=_xeUtils.default.toDateString(d,s))&&ne(d,{type:"check"}),H.inputValue=d;else{var c=!1;if("datetime"===e){var f=S.value;u===_xeUtils.default.toDateString(f,s)&&u===_xeUtils.default.toDateString(d,s)||(c=!0,i.setHours(d.getHours()),i.setMinutes(d.getMinutes()),i.setSeconds(d.getSeconds()))}else c=!0;H.inputValue=_xeUtils.default.toDateString(d,s),c&&xe(d)}else H.inputValue=H.datePanelLabel}else ne("",{type:"check"})},ye=function(e){var t=H.inputValue;R.value||ne(t,e),me(),H.visiblePanel||(H.isActivated=!1),u.dispatchEvent("blur",{value:t},e)},ge=function(e){var t=F.readonly,a=F.disabled,n=H.showPwd;a||t||(H.showPwd=!n),u.dispatchEvent("toggle-visible",{visible:H.showPwd},e)},be=function(e){u.dispatchEvent("search-click",{},e)},Ue=function(e,t){var a,n=F.min,u=F.max,i=F.type,l=H.inputValue,r=c.value,s="integer"===i?_xeUtils.default.toInteger(l):_xeUtils.default.toNumber(l),o=e?_xeUtils.default.add(s,r):_xeUtils.default.subtract(s,r);a=_e(o)?pe(o)?o:u:n,ue(J(a),t)},Ee=function(e){var t=F.readonly,a=F.disabled;clearTimeout(te),a||t||Ue(!1,e),u.dispatchEvent("next-number",{},e)},Se=function(e){var t=F.readonly,a=F.disabled;clearTimeout(te),a||t||Ue(!0,e),u.dispatchEvent("prev-number",{},e)},De=function(e){var t,a,n,u=F.exponential,i=F.controls;if(p.value){var l=e.ctrlKey,r=e.shiftKey,s=e.altKey,o=e.keyCode;l||r||s||!((0,_event.hasEventKey)(e,_event.EVENT_KEYS.SPACEBAR)||(!u||69!==o)&&65<=o&&o<=90||186<=o&&o<=188||191<=o)||e.preventDefault(),i&&(t=e,a=(0,_event.hasEventKey)(t,_event.EVENT_KEYS.ARROW_UP),n=(0,_event.hasEventKey)(t,_event.EVENT_KEYS.ARROW_DOWN),(a||n)&&(t.preventDefault(),a?Se(t):Ee(t)))}ae(e)},Pe=function(e){ae(e)},we=function(){clearTimeout(te)},Ne=function(e){if(we(),0===e.button){var t=(0,_dom.hasClass)(e.currentTarget,"is--prev");t?Se(e):Ee(e),te=window.setTimeout(function(){t?function e(t){te=window.setTimeout(function(){Se(t),e(t)},60)}(e):function e(t){te=window.setTimeout(function(){Ee(t),e(t)},60)}(e)},500)}},Te=function(e){if(p.value&&F.controls&&H.isActivated){var t=e.deltaY;0<t?Ee(e):t<0&&Se(e),e.preventDefault()}ae(e)},Ve=function(e,t){H.selectMonth=_xeUtils.default.getWhatMonth(e,t,"first")},ke=function(){var e=_xeUtils.default.getWhatDay(Date.now(),0,"first");H.currentDate=e,Ve(e,0)},Me=function(){var e=H.datePanelType;e="month"===e||"quarter"===e?"year":"month",H.datePanelType=e},We=function(e){var t=F.type,a=H.datePanelType,n=H.selectMonth;h.value||(H.selectMonth="year"===t?_xeUtils.default.getWhatYear(n,-yearSize,"first"):"month"===t||"quarter"===t?"year"===a?_xeUtils.default.getWhatYear(n,-yearSize,"first"):_xeUtils.default.getWhatYear(n,-1,"first"):"year"===a?_xeUtils.default.getWhatYear(n,-yearSize,"first"):"month"===a?_xeUtils.default.getWhatYear(n,-1,"first"):_xeUtils.default.getWhatMonth(n,-1,"first"),u.dispatchEvent("date-prev",{type:t},e))},Ye=function(e){ke(),xe(H.currentDate),oe(),u.dispatchEvent("date-today",{type:F.type},e)},Ke=function(e){var t=F.type,a=H.datePanelType,n=H.selectMonth;x.value||(H.selectMonth="year"===t?_xeUtils.default.getWhatYear(n,yearSize,"first"):"month"===t||"quarter"===t?"year"===a?_xeUtils.default.getWhatYear(n,yearSize,"first"):_xeUtils.default.getWhatYear(n,1,"first"):"year"===a?_xeUtils.default.getWhatYear(n,yearSize,"first"):"month"===a?_xeUtils.default.getWhatYear(n,1,"first"):_xeUtils.default.getWhatMonth(n,1,"first"),u.dispatchEvent("date-next",{type:t},e))},Ce=function(e){var t=F.disabledMethod,a=H.datePanelType;return t&&t({type:a,viewType:a,date:e.date,$input:v})},Ae=function(e){var t=F.type,a=H.datePanelType;"month"===t?"year"===a?(H.datePanelType="month",he(e)):(xe(e),oe()):"year"===t?(xe(e),oe()):"quarter"===t?"year"===a?(H.datePanelType="quarter",he(e)):(xe(e),oe()):"month"===a?(H.datePanelType="week"===t?t:"day",he(e)):"year"===a?(H.datePanelType="month",he(e)):(xe(e),oe())},qe=function(e){Ce(e)||Ae(e.date)},Re=function(t){Ce({date:t})||(W.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyyMMdd")})||he(t),ce(t))},Fe=function(t){Ce({date:t})||(b.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyy")})||he(t),ce(t))},Ie=function(t){Ce({date:t})||(T.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyyq")})||he(t),ce(t))},Oe=function(t){Ce({date:t})||(k.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyyMM")})||he(t),ce(t))},He=function(e){if(!Ce(e)){var t=H.datePanelType;"month"===t?Oe(e.date):"quarter"===t?Ie(e.date):"year"===t?Fe(e.date):Re(e.date)}},ze=function(e){if(e){var t=e.offsetHeight;e.parentNode.scrollTop=e.offsetTop-4*t}},Le=function(e){H.datetimePanelValue=new Date(H.datetimePanelValue.getTime()),ze(e.currentTarget)},Ge=function(){var e=S.value;xe(e||H.currentDate),oe()},Be=function(){return(0,_vue.nextTick)().then(function(){var e=F.transfer,t=F.placement,a=H.panelIndex,n=L.value,u=G.value;if(n&&u){var i=n.offsetHeight,l=n.offsetWidth,r=u.offsetHeight,s=u.offsetWidth,o={zIndex:a},v=(0,_dom.getAbsolutePos)(n),d=v.boundingTop,c=v.boundingLeft,f=v.visibleHeight,p=v.visibleWidth,_="bottom";if(e){var h=c,x=d+i;"top"===t?(_="top",x=d-r):t||(f<x+r+5&&(_="top",x=d-r),x<5&&(_="bottom",x=d+i)),p<h+s+5&&(h-=h+s+5-p),h<5&&(h=5),Object.assign(o,{left:h+"px",top:x+"px",minWidth:l+"px"})}else"top"===t?(_="top",o.bottom=i+"px"):t||f<d+i+r&&5<d-i-r&&(_="top",o.bottom=i+"px");return H.panelStyle=o,H.panelPlacement=_,(0,_vue.nextTick)()}})},Qe=function(){var e,t,a,n=F.disabled,u=H.visiblePanel,i=B.value;n||u||(H.inited||(H.inited=!0),clearTimeout(ee),H.isActivated=!0,H.animatVisible=!0,i&&(e=F.type,t=r.value,a=S.value,-1<["year","quarter","month","week"].indexOf(e)?H.datePanelType=e:H.datePanelType="day",H.currentDate=_xeUtils.default.getWhatDay(Date.now(),0,"first"),a?(Ve(a,0),ce(a)):ke(),t&&(H.datetimePanelValue=H.datePanelValue||_xeUtils.default.getWhatDay(Date.now(),0,"first"),(0,_vue.nextTick)(function(){var e=l.value;_xeUtils.default.arrayEach(e.querySelectorAll("li.is--selected"),ze)}))),setTimeout(function(){H.visiblePanel=!0},10),H.panelIndex<(0,_utils.getLastZIndex)()&&(H.panelIndex=(0,_utils.nextZIndex)()),Be())},$e=function(e){F.readonly||(e.preventDefault(),Qe())},je=function(e){B.value&&$e(e),ae(e)},Ze=function(e){var t=F.disabled,a=H.visiblePanel,n=H.isActivated,u=B.value,i=z.value,l=G.value;!t&&n&&(H.isActivated=(0,_dom.getEventTargetNode)(e,i).flag||(0,_dom.getEventTargetNode)(e,l).flag,H.isActivated||(u?a&&(oe(),me()):me()))},Xe=function(e){var t=F.clearable,a=F.disabled,n=H.visiblePanel,u=B.value;if(!a){var i=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.TAB),l=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.DELETE),r=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ESCAPE),s=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ENTER),o=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_LEFT),v=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_UP),d=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_RIGHT),c=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_DOWN),f=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.PAGE_UP),p=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.PAGE_DOWN),_=o||v||d||c,h=H.isActivated;i?(h&&me(),h=!1,H.isActivated=h):_?u&&h&&(n?function(e){var t=H.isActivated,a=H.datePanelValue,n=H.datePanelType;if(t){e.preventDefault();var u=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_LEFT),i=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_UP),l=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_RIGHT),r=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_DOWN);if("year"===n){var s=_xeUtils.default.getWhatYear(a||Date.now(),0,"first");u?s=_xeUtils.default.getWhatYear(s,-1):i?s=_xeUtils.default.getWhatYear(s,-4):l?s=_xeUtils.default.getWhatYear(s,1):r&&(s=_xeUtils.default.getWhatYear(s,4)),Fe(s)}else if("quarter"===n){var o=_xeUtils.default.getWhatQuarter(a||Date.now(),0,"first");u?o=_xeUtils.default.getWhatQuarter(o,-1):i?o=_xeUtils.default.getWhatQuarter(o,-2):l?o=_xeUtils.default.getWhatQuarter(o,1):r&&(o=_xeUtils.default.getWhatQuarter(o,2)),Ie(o)}else if("month"===n){var v=_xeUtils.default.getWhatMonth(a||Date.now(),0,"first");u?v=_xeUtils.default.getWhatMonth(v,-1):i?v=_xeUtils.default.getWhatMonth(v,-4):l?v=_xeUtils.default.getWhatMonth(v,1):r&&(v=_xeUtils.default.getWhatMonth(v,4)),Oe(v)}else{var d=a||_xeUtils.default.getWhatDay(Date.now(),0,"first");u?d=_xeUtils.default.getWhatDay(d,-1):i?d=_xeUtils.default.getWhatWeek(d,-1):l?d=_xeUtils.default.getWhatDay(d,1):r&&(d=_xeUtils.default.getWhatWeek(d,1)),Re(d)}}}(e):(v||c)&&$e(e)):s?u&&(n?H.datePanelValue?Ae(H.datePanelValue):oe():h&&$e(e)):(f||p)&&u&&h&&function(e){if(H.isActivated){var t=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.PAGE_UP);e.preventDefault(),t?We(e):Ke(e)}}(e),i||r?n&&oe():l&&t&&h&&ve(e,null)}},Je=function(e){var t=F.disabled,a=H.visiblePanel;if(!t&&a){var n=G.value;(0,_dom.getEventTargetNode)(e,n).flag?Be():(oe(),me())}},et=function(){var e=H.isActivated;H.visiblePanel?(oe(),me()):e&&me()},tt=function(e,t){var a=F.festivalMethod;if(a){var n=H.datePanelType,u=a({type:n,viewType:n,date:e.date,$input:v}),i=u?_xeUtils.default.isString(u)?{label:u}:u:{},l=i.extra?_xeUtils.default.isString(i.extra)?{label:i.extra}:i.extra:null,r=[(0,_vue.h)("span",{class:["vxe-input--date-label",{"is-notice":i.notice}]},l&&l.label?[(0,_vue.h)("span",t),(0,_vue.h)("span",{class:["vxe-input--date-label--extra",l.important?"is-important":"",l.className],style:l.style},_xeUtils.default.toValueString(l.label))]:t)],s=i.label;if(s){var o=_xeUtils.default.toValueString(s).split(",");r.push((0,_vue.h)("span",{class:["vxe-input--date-festival",i.important?"is-important":"",i.className],style:i.style},[1<o.length?(0,_vue.h)("span",{class:["vxe-input--date-festival--overlap","overlap--"+o.length]},o.map(function(e){return(0,_vue.h)("span",e.substring(0,3))})):(0,_vue.h)("span",{class:"vxe-input--date-festival--label"},o[0].substring(0,3))]))}return r}return t},at=function(){var e,t,a,n,u,i,l,r,s,o,v,d,c,f,p,_,h,x,m,y,g,b,U,E;switch(H.datePanelType){case"week":return c=H.datePanelType,f=H.datePanelValue,p=S.value,_=P.value,h=K.value,x="yyyyMMdd",[(0,_vue.h)("table",{class:"vxe-input--date-"+c+"-view",cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("thead",[(0,_vue.h)("tr",_.map(function(e){return(0,_vue.h)("th",e.label)}))]),(0,_vue.h)("tbody",h.map(function(e){var t=e.some(function(e){return _xeUtils.default.isDateSame(p,e.date,x)}),a=e.some(function(e){return _xeUtils.default.isDateSame(f,e.date,x)});return(0,_vue.h)("tr",e.map(function(e){return(0,_vue.h)("td",{class:{"is--prev":e.isPrev,"is--current":e.isCurrent,"is--now":e.isNow,"is--next":e.isNext,"is--disabled":Ce(e),"is--selected":t,"is--hover":a},onClick:function(){return qe(e)},onMouseenter:function(){return He(e)}},tt(e,e.label))}))}))])];case"month":return s=H.datePanelType,o=H.datePanelValue,v=S.value,d=M.value,[(0,_vue.h)("table",{class:"vxe-input--date-"+s+"-view",cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",d.map(function(e){return(0,_vue.h)("tr",e.map(function(e){return(0,_vue.h)("td",{class:{"is--prev":e.isPrev,"is--current":e.isCurrent,"is--now":e.isNow,"is--next":e.isNext,"is--disabled":Ce(e),"is--selected":_xeUtils.default.isDateSame(v,e.date,"yyyyMM"),"is--hover":_xeUtils.default.isDateSame(o,e.date,"yyyyMM")},onClick:function(){return qe(e)},onMouseenter:function(){return He(e)}},tt(e,_conf.default.i18n("vxe.input.date.months.m"+e.month)))}))}))])];case"quarter":return u=H.datePanelType,i=H.datePanelValue,l=S.value,r=V.value,[(0,_vue.h)("table",{class:"vxe-input--date-"+u+"-view",cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",r.map(function(e){return(0,_vue.h)("tr",e.map(function(e){return(0,_vue.h)("td",{class:{"is--prev":e.isPrev,"is--current":e.isCurrent,"is--now":e.isNow,"is--next":e.isNext,"is--disabled":Ce(e),"is--selected":_xeUtils.default.isDateSame(l,e.date,"yyyyq"),"is--hover":_xeUtils.default.isDateSame(i,e.date,"yyyyq")},onClick:function(){return qe(e)},onMouseenter:function(){return He(e)}},tt(e,_conf.default.i18n("vxe.input.date.quarters.q"+e.quarter)))}))}))])];case"year":return e=H.datePanelType,t=H.datePanelValue,a=S.value,n=w.value,[(0,_vue.h)("table",{class:"vxe-input--date-"+e+"-view",cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",n.map(function(e){return(0,_vue.h)("tr",e.map(function(e){return(0,_vue.h)("td",{class:{"is--disabled":Ce(e),"is--current":e.isCurrent,"is--now":e.isNow,"is--selected":_xeUtils.default.isDateSame(a,e.date,"yyyy"),"is--hover":_xeUtils.default.isDateSame(t,e.date,"yyyy")},onClick:function(){return qe(e)},onMouseenter:function(){return He(e)}},tt(e,e.year))}))}))])]}return m=H.datePanelType,y=H.datePanelValue,g=S.value,b=D.value,U=Y.value,E="yyyyMMdd",[(0,_vue.h)("table",{class:"vxe-input--date-"+m+"-view",cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("thead",[(0,_vue.h)("tr",b.map(function(e){return(0,_vue.h)("th",e.label)}))]),(0,_vue.h)("tbody",U.map(function(e){return(0,_vue.h)("tr",e.map(function(e){return(0,_vue.h)("td",{class:{"is--prev":e.isPrev,"is--current":e.isCurrent,"is--now":e.isNow,"is--next":e.isNext,"is--disabled":Ce(e),"is--selected":_xeUtils.default.isDateSame(g,e.date,E),"is--hover":_xeUtils.default.isDateSame(y,e.date,E)},onClick:function(){return qe(e)},onMouseenter:function(){return He(e)}},tt(e,e.label))}))}))])]},nt=function(){var e=H.datePanelType,t=h.value,a=x.value,n=U.value;return[(0,_vue.h)("div",{class:"vxe-input--date-picker-header"},[(0,_vue.h)("div",{class:"vxe-input--date-picker-type-wrapper"},["year"===e?(0,_vue.h)("span",{class:"vxe-input--date-picker-label"},n):(0,_vue.h)("span",{class:"vxe-input--date-picker-btn",onClick:Me},n)]),(0,_vue.h)("div",{class:"vxe-input--date-picker-btn-wrapper"},[(0,_vue.h)("span",{class:["vxe-input--date-picker-btn vxe-input--date-picker-prev-btn",{"is--disabled":t}],onClick:We},[(0,_vue.h)("i",{class:"vxe-icon--caret-left"})]),(0,_vue.h)("span",{class:"vxe-input--date-picker-btn vxe-input--date-picker-current-btn",onClick:Ye},[(0,_vue.h)("i",{class:"vxe-icon--dot"})]),(0,_vue.h)("span",{class:["vxe-input--date-picker-btn vxe-input--date-picker-next-btn",{"is--disabled":a}],onClick:Ke},[(0,_vue.h)("i",{class:"vxe-icon--caret-right"})])])]),(0,_vue.h)("div",{class:"vxe-input--date-picker-body"},at())]},ut=function(){var t=H.datetimePanelValue,e=m.value,a=C.value,n=A.value,u=q.value;return[(0,_vue.h)("div",{class:"vxe-input--time-picker-header"},[(0,_vue.h)("span",{class:"vxe-input--time-picker-title"},e),(0,_vue.h)("button",{class:"vxe-input--time-picker-confirm",type:"button",onClick:Ge},_conf.default.i18n("vxe.button.confirm"))]),(0,_vue.h)("div",{ref:l,class:"vxe-input--time-picker-body"},[(0,_vue.h)("ul",{class:"vxe-input--time-picker-hour-list"},a.map(function(n,e){return(0,_vue.h)("li",{key:e,class:{"is--selected":t&&t.getHours()===n.value},onClick:function(e){return t=e,a=n,H.datetimePanelValue.setHours(a.value),void Le(t);var t,a}},n.label)})),(0,_vue.h)("ul",{class:"vxe-input--time-picker-minute-list"},n.map(function(n,e){return(0,_vue.h)("li",{key:e,class:{"is--selected":t&&t.getMinutes()===n.value},onClick:function(e){return t=e,a=n,H.datetimePanelValue.setMinutes(a.value),void Le(t);var t,a}},n.label)})),(0,_vue.h)("ul",{class:"vxe-input--time-picker-second-list"},u.map(function(n,e){return(0,_vue.h)("li",{key:e,class:{"is--selected":t&&t.getSeconds()===n.value},onClick:function(e){return t=e,a=n,H.datetimePanelValue.setSeconds(a.value),void Le(t);var t,a}},n.label)}))])]},it=function(){var e,t,a=F.controls,n=p.value,u=B.value,i=s.value,l=o.value;return i?(t=H.showPwd,e=(0,_vue.h)("span",{class:"vxe-input--password-suffix",onClick:ge},[(0,_vue.h)("i",{class:["vxe-input--password-icon",t?_conf.default.icon.INPUT_SHOW_PWD:_conf.default.icon.INPUT_PWD]})])):n?a&&(e=(0,_vue.h)("span",{class:"vxe-input--number-suffix"},[(0,_vue.h)("span",{class:"vxe-input--number-prev is--prev",onMousedown:Ne,onMouseup:we,onMouseleave:we},[(0,_vue.h)("i",{class:["vxe-input--number-prev-icon",_conf.default.icon.INPUT_PREV_NUM]})]),(0,_vue.h)("span",{class:"vxe-input--number-next is--next",onMousedown:Ne,onMouseup:we,onMouseleave:we},[(0,_vue.h)("i",{class:["vxe-input--number-next-icon",_conf.default.icon.INPUT_NEXT_NUM]})])])):u?e=(0,_vue.h)("span",{class:"vxe-input--date-picker-suffix",onClick:$e},[(0,_vue.h)("i",{class:["vxe-input--date-picker-icon",_conf.default.icon.INPUT_DATE]})]):l&&(e=(0,_vue.h)("span",{class:"vxe-input--search-suffix",onClick:be},[(0,_vue.h)("i",{class:["vxe-input--search-icon",_conf.default.icon.INPUT_SEARCH]})])),e?(0,_vue.h)("span",{class:"vxe-input--extra-suffix"},[e]):null};u={dispatchEvent:function(e,t,a){n(e,Object.assign({$input:v,$event:a},t))},focus:function(){var e=L.value;return H.isActivated=!0,e.focus(),(0,_vue.nextTick)()},blur:function(){return L.value.blur(),H.isActivated=!1,(0,_vue.nextTick)()}},Object.assign(v,u),(0,_vue.watch)(function(){return F.modelValue},function(e){H.inputValue=e,fe()}),(0,_vue.watch)(g,function(){ce(H.datePanelValue),H.inputValue=H.datePanelLabel}),(0,_vue.nextTick)(function(){_event.GlobalEvent.on(v,"mousewheel",Je),_event.GlobalEvent.on(v,"mousedown",Ze),_event.GlobalEvent.on(v,"keydown",Xe),_event.GlobalEvent.on(v,"blur",et)}),(0,_vue.onUnmounted)(function(){we(),_event.GlobalEvent.off(v,"mousewheel"),_event.GlobalEvent.off(v,"mousedown"),_event.GlobalEvent.off(v,"keydown"),_event.GlobalEvent.off(v,"blur")}),function(){var e=F.type,t=H.inputValue,a=B.value,n=d.value;if(a)fe();else if("float"===e&&t){var u=_xeUtils.default.toFixed(_xeUtils.default.floor(t,n),n);t!==u&&ne(u,{type:"init"})}}();return v.renderVN=function(){var e,t,a,n,u,i,l,r,s,o,v,d,c,f,p,_,h,x,m,y,g=F.className,b=F.controls,U=F.type,E=F.align,S=F.name,D=F.disabled,P=F.readonly,w=F.autocomplete,N=H.inputValue,T=H.visiblePanel,V=H.isActivated,k=O.value,M=B.value,W=$.value,Y=X.value,K=j.value,C=Z.value,A=[],q=(t=F.prefixIcon,a=I.prefix,n=[],a?n.push((0,_vue.h)("span",{class:"vxe-input--prefix-icon"},a({}))):t&&n.push((0,_vue.h)("i",{class:["vxe-input--prefix-icon",t]})),n.length?(0,_vue.h)("span",{class:"vxe-input--prefix",onClick:se},n):null),R=(u=F.disabled,i=F.suffixIcon,l=H.inputValue,r=I.suffix,s=Q.value,o=[],r?o.push((0,_vue.h)("span",{class:"vxe-input--suffix-icon"},r({}))):i&&o.push((0,_vue.h)("i",{class:["vxe-input--suffix-icon",i]})),s&&o.push((0,_vue.h)("i",{class:["vxe-input--clear-icon",_conf.default.icon.INPUT_CLEAR]})),o.length?(0,_vue.h)("span",{class:["vxe-input--suffix",{"is--clear":s&&!u&&!(""===l||_xeUtils.default.eqNull(l))}],onClick:de},o):null);return q&&A.push(q),A.push((0,_vue.h)("input",{ref:L,class:"vxe-input--inner",value:N,name:S,type:K,placeholder:C,maxlength:Y,readonly:W,disabled:D,autocomplete:w,onKeydown:De,onKeyup:Pe,onWheel:Te,onClick:je,onInput:ie,onChange:le,onFocus:re,onBlur:ye})),R&&A.push(R),A.push(it()),M&&A.push((d=F.type,c=F.transfer,f=H.inited,p=H.animatVisible,_=H.visiblePanel,h=H.panelPlacement,x=H.panelStyle,m=O.value,y=[],B.value?("datetime"===d?y.push((0,_vue.h)("div",{class:"vxe-input--panel-layout-wrapper"},[(0,_vue.h)("div",{class:"vxe-input--panel-left-wrapper"},nt()),(0,_vue.h)("div",{class:"vxe-input--panel-right-wrapper"},ut())])):"time"===d?y.push((0,_vue.h)("div",{class:"vxe-input--panel-wrapper"},ut())):y.push((0,_vue.h)("div",{class:"vxe-input--panel-wrapper"},nt())),(0,_vue.h)(_vue.Teleport,{to:"body",disabled:!c||!f},[(0,_vue.h)("div",{ref:G,class:["vxe-table--ignore-clear vxe-input--panel","type--"+d,(v={},v["size--"+m]=m,v["is--transfer"]=c,v["animat--leave"]=p,v["animat--enter"]=_,v)],placement:h,style:x},y)])):null)),(0,_vue.h)("div",{ref:z,class:["vxe-input","type--"+U,g,(e={},e["size--"+k]=k,e["is--"+E]=E,e["is--controls"]=b,e["is--prefix"]=!!q,e["is--suffix"]=!!R,e["is--readonly"]=P,e["is--visivle"]=T,e["is--disabled"]=D,e["is--active"]=V,e)]},A)},v},render:function(){return this.renderVN()}});exports.default=_default2;
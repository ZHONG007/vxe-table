"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_utils=require("../../tools/utils"),_modal=_interopRequireDefault(require("../../modal/src/modal")),_input=_interopRequireDefault(require("../../input/src/input")),_checkbox=_interopRequireDefault(require("../../checkbox/src/checkbox")),_select=_interopRequireDefault(require("../../select/src/select")),_button=_interopRequireDefault(require("../../button/src/button"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default2=(0,_vue.defineComponent)({name:"VxeExportPanel",props:{defaultOptions:Object,storeData:Object},setup:function(v){var o=(0,_vue.inject)("$xetable",{}),e=o.getComputeMaps(),u=e.computeExportOpts,a=e.computePrintOpts,f=(0,_vue.reactive)({isAll:!1,isIndeterminate:!1,loading:!1}),h=(0,_vue.ref)(),_=(0,_vue.ref)(),m=(0,_vue.ref)(),b=(0,_vue.computed)(function(){return v.storeData.columns.every(function(e){return e.checked})}),k=(0,_vue.computed)(function(){var e=v.defaultOptions;return-1<["html","xml","xlsx","pdf"].indexOf(e.type)}),g=(0,_vue.computed)(function(){var e=v.storeData,t=v.defaultOptions;return!t.original&&"current"===t.mode&&(e.isPrint||-1<["html","xlsx"].indexOf(t.type))}),V=(0,_vue.computed)(function(){var e=v.defaultOptions;return!e.original&&-1<["xlsx"].indexOf(e.type)}),n=function(){var e=v.storeData.columns;f.isAll=e.every(function(e){return e.disabled||e.checked}),f.isIndeterminate=!f.isAll&&e.some(function(e){return!e.disabled&&(e.checked||e.halfChecked)})},C=function(e){var t=!e.checked;_xeUtils.default.eachTree([e],function(e){e.checked=t,e.halfChecked=!1}),function e(t){var n=v.storeData,l=_xeUtils.default.findTree(n.columns,function(e){return e===t});if(l&&l.parent){var o=l.parent;o.children&&o.children.length&&(o.checked=o.children.every(function(e){return e.checked}),o.halfChecked=!o.checked&&o.children.some(function(e){return e.checked||e.halfChecked}),e(o))}}(e),n()},O=function(){var e=v.storeData,t=!f.isAll;_xeUtils.default.eachTree(e.columns,function(e){e.disabled||(e.checked=t,e.halfChecked=!1)}),f.isAll=t,n()},D=function(){(0,_vue.nextTick)(function(){var e=_.value,t=m.value,n=h.value,l=e||t||n;l&&l.focus()}),n()},i=function(){var e=v.storeData,t=v.defaultOptions,n=e.hasMerge,l=e.columns,o=b.value,u=g.value,a=_xeUtils.default.searchTree(l,function(e){return e.checked},{children:"children",mapChildren:"childNodes",original:!0});return Object.assign({},t,{columns:a,isMerge:!!(n&&u&&o)&&t.isMerge})},y=function(){v.storeData.visible=!1},T=function(){var e,t,n,l;v.storeData.isPrint?(n=v.storeData,l=a.value,n.visible=!1,o.print(Object.assign({},l,i()))):(e=v.storeData,t=u.value,f.loading=!0,o.exportData(Object.assign({},t,i())).then(function(){f.loading=!1,e.visible=!1}).catch(function(){f.loading=!1}))};return function(){var t=v.defaultOptions,n=v.storeData,e=f.isAll,l=f.isIndeterminate,o=n.hasTree,u=n.hasMerge,a=n.isPrint,i=n.hasColgroup,c=t.isHeader,r=[],d=b.value,s=k.value,p=g.value,x=V.value;return _xeUtils.default.eachTree(n.columns,function(e){var t=(0,_utils.formatText)(e.getTitle(),1),n=e.children&&e.children.length;r.push((0,_vue.h)("li",{class:["vxe-export--panel-column-option","level--"+e.level,{"is--group":n,"is--checked":e.checked,"is--indeterminate":e.halfChecked,"is--disabled":e.disabled}],title:t,onClick:function(){e.disabled||C(e)}},[(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--label"},t)]))}),(0,_vue.h)(_modal.default,{modelValue:n.visible,title:_conf.default.i18n(a?"vxe.export.printTitle":"vxe.export.expTitle"),width:660,mask:!0,lockView:!0,showFooter:!1,escClosable:!0,maskClosable:!0,loading:f.loading,"onUpdate:modelValue":function(e){n.visible=e},onShow:D},{default:function(){return(0,_vue.h)("div",{class:"vxe-export--panel"},[(0,_vue.h)("table",{cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",[[a?(0,_vue.createCommentVNode)():(0,_vue.h)("tr",[(0,_vue.h)("td",_conf.default.i18n("vxe.export.expName")),(0,_vue.h)("td",[(0,_vue.h)(_input.default,{ref:_,modelValue:t.filename,type:"text",clearable:!0,placeholder:_conf.default.i18n("vxe.export.expNamePlaceholder"),"onUpdate:modelValue":function(e){t.filename=e}})])]),a?(0,_vue.createCommentVNode)():(0,_vue.h)("tr",[(0,_vue.h)("td",_conf.default.i18n("vxe.export.expType")),(0,_vue.h)("td",[(0,_vue.h)(_select.default,{modelValue:t.type,options:n.typeList.map(function(e){return{value:e.value,label:_conf.default.i18n(e.label)}}),"onUpdate:modelValue":function(e){t.type=e}})])]),a||s?(0,_vue.h)("tr",[(0,_vue.h)("td",_conf.default.i18n("vxe.export.expSheetName")),(0,_vue.h)("td",[(0,_vue.h)(_input.default,{ref:m,modelValue:t.sheetName,type:"text",clearable:!0,placeholder:_conf.default.i18n("vxe.export.expSheetNamePlaceholder"),"onUpdate:modelValue":function(e){t.sheetName=e}})])]):(0,_vue.createCommentVNode)(),(0,_vue.h)("tr",[(0,_vue.h)("td",_conf.default.i18n("vxe.export.expMode")),(0,_vue.h)("td",[(0,_vue.h)(_select.default,{modelValue:t.mode,options:n.modeList.map(function(e){return{value:e.value,label:_conf.default.i18n(e.label)}}),"onUpdate:modelValue":function(e){t.mode=e}})])]),(0,_vue.h)("tr",[(0,_vue.h)("td",[_conf.default.i18n("vxe.export.expColumn")]),(0,_vue.h)("td",[(0,_vue.h)("div",{class:"vxe-export--panel-column"},[(0,_vue.h)("ul",{class:"vxe-export--panel-column-header"},[(0,_vue.h)("li",{class:["vxe-export--panel-column-option",{"is--checked":e,"is--indeterminate":l}],title:_conf.default.i18n("vxe.table.allTitle"),onClick:O},[(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--label"},_conf.default.i18n("vxe.export.expCurrentColumn"))])]),(0,_vue.h)("ul",{class:"vxe-export--panel-column-body"},r)])])]),(0,_vue.h)("tr",[(0,_vue.h)("td",_conf.default.i18n("vxe.export.expOpts")),(0,_vue.h)("td",[(0,_vue.h)("div",{class:"vxe-export--panel-option-row"},[(0,_vue.h)(_checkbox.default,{modelValue:t.isHeader,title:_conf.default.i18n("vxe.export.expHeaderTitle"),content:_conf.default.i18n("vxe.export.expOptHeader"),"onUpdate:modelValue":function(e){t.isHeader=e}}),(0,_vue.h)(_checkbox.default,{modelValue:t.isFooter,disabled:!n.hasFooter,title:_conf.default.i18n("vxe.export.expFooterTitle"),content:_conf.default.i18n("vxe.export.expOptFooter"),"onUpdate:modelValue":function(e){t.isFooter=e}}),(0,_vue.h)(_checkbox.default,{modelValue:t.original,title:_conf.default.i18n("vxe.export.expOriginalTitle"),content:_conf.default.i18n("vxe.export.expOptOriginal"),"onUpdate:modelValue":function(e){t.original=e}})]),(0,_vue.h)("div",{class:"vxe-export--panel-option-row"},[(0,_vue.h)(_checkbox.default,{modelValue:!!(c&&i&&p)&&t.isColgroup,title:_conf.default.i18n("vxe.export.expColgroupTitle"),disabled:!c||!i||!p,content:_conf.default.i18n("vxe.export.expOptColgroup"),"onUpdate:modelValue":function(e){t.isColgroup=e}}),(0,_vue.h)(_checkbox.default,{modelValue:!!(u&&p&&d)&&t.isMerge,title:_conf.default.i18n("vxe.export.expMergeTitle"),disabled:!u||!p||!d,content:_conf.default.i18n("vxe.export.expOptMerge"),"onUpdate:modelValue":function(e){t.isMerge=e}}),a?(0,_vue.createCommentVNode)():(0,_vue.h)(_checkbox.default,{modelValue:!!x&&t.useStyle,disabled:!x,title:_conf.default.i18n("vxe.export.expUseStyleTitle"),content:_conf.default.i18n("vxe.export.expOptUseStyle"),"onUpdate:modelValue":function(e){t.useStyle=e}}),(0,_vue.h)(_checkbox.default,{modelValue:!!o&&t.isAllExpand,disabled:!o,title:_conf.default.i18n("vxe.export.expAllExpandTitle"),content:_conf.default.i18n("vxe.export.expOptAllExpand"),"onUpdate:modelValue":function(e){t.isAllExpand=e}})])])])]])]),(0,_vue.h)("div",{class:"vxe-export--panel-btns"},[(0,_vue.h)(_button.default,{content:_conf.default.i18n("vxe.export.expCancel"),onClick:y}),(0,_vue.h)(_button.default,{ref:h,status:"primary",content:_conf.default.i18n(a?"vxe.export.expPrint":"vxe.export.expConfirm"),onClick:T})])])}})}}});exports.default=_default2;
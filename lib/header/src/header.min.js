"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_util=require("./util"),_util2=require("../../table/src/util"),_dom=require("../../tools/dom");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var l,t=1,r=arguments.length;t<r;t++)for(var n in l=arguments[t])Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);return e}).apply(this,arguments)},renderType="header",_default=(0,_vue.defineComponent)({name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,tableGroupColumn:Array,fixedColumn:Array,fixedType:{type:String,default:null}},setup:function(q){var A=(0,_vue.inject)("$xetable",{}),o=A.xID,u=A.props,s=A.reactData,E=A.internalData,e=A.getRefMaps(),O=e.refElem,F=e.refTableBody,L=e.refLeftContainer,N=e.refRightContainer,j=e.refCellResizeBar,d=(0,_vue.ref)([]),G=(0,_vue.ref)(),c=(0,_vue.ref)(),f=(0,_vue.ref)(),v=(0,_vue.ref)(),p=(0,_vue.ref)(),h=(0,_vue.ref)(),r=function(){var e=s.isGroup;d.value=e?(0,_util.convertToRows)(q.tableGroupColumn):[]};(0,_vue.watch)(function(){return q.tableColumn},r),(0,_vue.nextTick)(function(){var e=q.fixedType,l=A.internalData.elemStore,t=(e||"main")+"-header-";l[t+"wrapper"]=G.value,l[t+"table"]=c.value,l[t+"colgroup"]=f.value,l[t+"list"]=v.value,l[t+"xSpace"]=p.value,l[t+"repair"]=h.value,r()});return function(){var w=q.fixedType,e=q.fixedColumn,l=q.tableColumn,M=u.resizable,T=u.border,z=u.columnKey,t=u.headerRowClassName,R=u.headerCellClassName,r=u.headerRowStyle,D=u.headerCellStyle,S=u.showHeaderOverflow,W=u.headerAlign,U=u.align,k=u.mouseConfig,n=s.isGroup,I=s.currentColumn,$=s.scrollXLoad,H=s.overflowX,a=s.scrollbarWidth,i=d.value;return n||(w&&($||S)&&(l=e),i=[l]),(0,_vue.h)("div",{ref:G,class:["vxe-table--header-wrapper",w?"fixed-"+w+"--wrapper":"body--wrapper"],xid:o},[w?(0,_vue.createCommentVNode)():(0,_vue.h)("div",{ref:p,class:"vxe-body--x-space"}),(0,_vue.h)("table",{ref:c,class:"vxe-table--header",xid:o,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("colgroup",{ref:f},l.map(function(e,l){return(0,_vue.h)("col",{name:e.id,key:l})}).concat(a?[(0,_vue.h)("col",{name:"col_gutter"})]:[])),(0,_vue.h)("thead",{ref:v},i.map(function(y,C){return(0,_vue.h)("tr",{class:["vxe-header--row",t?_xeUtils.default.isFunction(t)?t({$table:A,$rowIndex:C,fixed:w,type:renderType}):t:""],style:r?_xeUtils.default.isFunction(r)?r({$table:A,$rowIndex:C,fixed:w,type:renderType}):r:null},y.map(function(e,l){var t,r=e.type,n=e.showHeaderOverflow,a=e.headerAlign,i=e.align,o=e.headerClassName,u=e.children&&e.children.length,s=w?e.fixed!==w&&!u:!!e.fixed&&H,d=_xeUtils.default.isUndefined(n)||_xeUtils.default.isNull(n)?S:n,c=a||i||W||U,f="ellipsis"===d,v="title"===d,p=!0===d||"tooltip"===d,h=v||p||f,m=e.filters&&e.filters.some(function(e){return e.checked}),_=A.getColumnIndex(e),x=A.getVTColumnIndex(e),g={$table:A,$rowIndex:C,column:e,columnIndex:_,$columnIndex:l,_columnIndex:x,fixed:w,type:renderType,isHidden:s,hasFilter:m},b={onClick:function(e){return A.triggerHeaderCellClickEvent(e,g)},onDblclick:function(e){return A.triggerHeaderCellDblclickEvent(e,g)}};return $&&!h&&(f=h=!0),k&&(b.onMousedown=function(e){return A.triggerHeaderCellMousedownEvent(e,g)}),(0,_vue.h)("th",__assign(__assign({class:["vxe-header--column",e.id,(t={},t["col--"+c]=c,t["col--"+r]=r,t["col--last"]=l===y.length-1,t["col--fixed"]=e.fixed,t["col--group"]=u,t["col--ellipsis"]=h,t["fixed--hidden"]=s,t["is--sortable"]=e.sortable,t["col--filter"]=!!e.filters,t["is--filter-active"]=m,t["col--current"]=I===e,t),o?_xeUtils.default.isFunction(o)?o(g):o:"",R?_xeUtils.default.isFunction(R)?R(g):R:""],colid:e.id,colspan:1<e.colSpan?e.colSpan:null,rowspan:1<e.rowSpan?e.rowSpan:null,style:D?_xeUtils.default.isFunction(D)?D(g):D:null},b),{key:z||u?e.id:l}),[(0,_vue.h)("div",{class:["vxe-cell",{"c--title":v,"c--tooltip":p,"c--ellipsis":f}]},e.renderHeader(g)),!s&&!u&&(_xeUtils.default.isBoolean(e.resizable)?e.resizable:M)?(0,_vue.h)("div",{class:["vxe-resizable",{"is--line":!T||"none"===T}],onMousedown:function(e){return function(e,l){var t=l.column,n=q.fixedType,r=F.value,a=L.value,i=N.value,o=j.value,u=e.clientX,s=G.value,d=e.target,c=l.cell=d.parentNode,f=0,v=r.$el,p=(0,_dom.getOffsetPos)(d,s),h=d.clientWidth,m=Math.floor(h/2),_=(0,_util2.getColMinWidth)(l)-m,x=p.left-c.clientWidth+h+_,g=p.left+m,b=document.onmousemove,y=document.onmouseup,C="left"===n,w="right"===n,M=O.value,T=0;if(C||w){for(var z=C?"nextElementSibling":"previousElementSibling",R=c[z];R&&!(0,_dom.hasClass)(R,"fixed--hidden");)(0,_dom.hasClass)(R,"col--group")||(T+=R.offsetWidth),R=R[z];w&&i&&(g=i.offsetLeft+T)}var D=function(e){e.stopPropagation(),e.preventDefault();var l=e.clientX-u,t=g+l,r=n?0:v.scrollLeft;C?t=Math.min(t,(i?i.offsetLeft:v.clientWidth)-T-_):w?(x=(a?a.clientWidth:0)+T+_,t=Math.min(t,g+c.clientWidth-_)):x=Math.max(v.scrollLeft,x),f=Math.max(t,x),o.style.left=f-r+"px"};E._isResize=!0,(0,_dom.addClass)(M,"drag--resize"),o.style.display="block",document.onmousemove=D,document.onmouseup=function(e){document.onmousemove=b,document.onmouseup=y,t.resizeWidth=t.renderWidth+(w?g-f:f-g),o.style.display="none",E._isResize=!1,E._lastResizeTime=Date.now(),A.analyColumnWidth(),A.recalculate(!0).then(function(){A.saveCustomResizable(),A.updateCellAreas(),A.dispatchEvent("resizable-change",l,e)}),(0,_dom.removeClass)(M,"drag--resize")},D(e),A.closeMenu&&A.closeMenu()}(e,g)}}):null])}).concat(a?[(0,_vue.h)("th",{class:"vxe-header--gutter col--gutter"})]:[]))}))]),(0,_vue.h)("div",{ref:h,class:"vxe-table--header-border-line"})])}}});exports.default=_default;
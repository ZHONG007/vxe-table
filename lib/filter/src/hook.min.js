"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_vXETable=require("../../v-x-e-table"),_util=require("../../table/src/util"),_dom=require("../../tools/dom");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,l=1,r=arguments.length;l<r;l++)for(var i in t=arguments[l])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},tableFilterMethodKeys=["setFilter","clearFilter","getCheckedFilters"],tableFilterHook={setupTable:function(u){var c=u.reactData,f=u.internalData,e=u.getRefMaps(),g=e.refTableBody,F=e.refTableFilter,d=u.getComputeMaps().computeFilterOpts,o={checkFilterOptions:function(){var e=c.filterStore;e.isAllSelected=e.options.every(function(e){return e._checked}),e.isIndeterminate=!e.isAllSelected&&e.options.some(function(e){return e._checked})},triggerFilterEvent:function(e,p,t){var l=c.initStore,v=c.filterStore;if(v.column===p&&v.visible)v.visible=!1;else{var _=e.target,m=e.pageX,b=(0,_dom.getDomNode)().visibleWidth,r=p.filters,i=p.filterMultiple,o=p.filterRender,a=o?_vXETable.VXETable.renderer.get(o.name):null,n=p.filterRecoverMethod||(a?a.filterRecoverMethod:null);f._currFilterParams=t,Object.assign(v,{multiple:i,options:r,column:p,style:null}),v.options.forEach(function(e){var t=e._checked,l=e.checked;(e._checked=l)||t===l||n&&n({option:e,column:p,$table:u})}),this.checkFilterOptions(),v.visible=!0,l.filter=!0,(0,_vue.nextTick)(function(){var e=g.value.$el,t=F.value,l=t?t.$el:null,r=0,i=0,o=null,a=null;l&&(r=l.offsetWidth,i=l.offsetHeight,o=l.querySelector(".vxe-table--filter-header"),a=l.querySelector(".vxe-table--filter-footer"));var n,f,s=r/2,u=e.clientWidth-r-10,c={top:_.offsetTop+_.offsetParent.offsetTop+_.offsetHeight+8+"px"},d=null;if(i>=e.clientHeight&&(d=e.clientHeight-(a?a.offsetHeight:0)-(o?o.offsetHeight:0)),"left"===p.fixed?n=_.offsetLeft+_.offsetParent.offsetLeft-s:"right"===p.fixed?f=_.offsetParent.offsetWidth-_.offsetLeft+(_.offsetParent.offsetParent.offsetWidth-_.offsetParent.offsetLeft)-p.renderWidth-s:n=_.offsetLeft+_.offsetParent.offsetLeft-s-e.scrollLeft,n)0<(h=m+r-s+10-b)&&(n-=h),c.left=Math.min(u,Math.max(10,n))+"px";else if(f){var h;0<(h=m+r-s+10-b)&&(f+=h),c.right=Math.max(10,f)+"px"}v.style=c,v.maxHeight=d})}},handleClearFilter:function(e){if(e){var t=e.filters,l=e.filterRender;if(t){var r=l?_vXETable.VXETable.renderer.get(l.name):null,i=e.filterResetMethod||(r?r.filterResetMethod:null);t.forEach(function(e){e._checked=!1,e.checked=!1,i||(e.data=_xeUtils.default.clone(e.resetValue,!0))}),i&&i({options:t,column:e,$table:u})}}},confirmFilterEvent:function(e){var t=c.filterStore,l=c.scrollXLoad,r=c.scrollYLoad,i=d.value,o=t.column,a=o.property,n=[],f=[];o.filters.forEach(function(e){e.checked&&(n.push(e.value),f.push(e.data))}),t.visible=!1;var s=u.getCheckedFilters();i.remote||(u.handleTableData(!0),u.checkSelectionStatus(),u.updateFooter(),(l||r)&&(u.clearScroll(),r&&u.updateScrollYSpace())),u.dispatchEvent("filter-change",{column:o,property:a,values:n,datas:f,filters:s,filterList:s},e),u.closeFilter(),(0,_vue.nextTick)(function(){u.recalculate(),u.updateCellAreas()})}};return __assign(__assign({},{setFilter:function(e,t){var l=(0,_util.handleFieldOrColumn)(u,e);return l&&l.filters&&t&&(l.filters=(0,_util.toFilters)(t)),(0,_vue.nextTick)()},clearFilter:function(e){var t,l=c.filterStore,r=f.tableFullColumn,i=d.value;return e?(t=(0,_util.handleFieldOrColumn)(u,e))&&o.handleClearFilter(t):r.forEach(o.handleClearFilter),e&&t===l.column||Object.assign(l,{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1}),i.remote?(0,_vue.nextTick)():u.updateData()},getCheckedFilters:function(){var e=f.tableFullColumn,o=[];return e.filter(function(e){var t=e.property,l=e.filters,r=[],i=[];l&&l.length&&(l.forEach(function(e){e.checked&&(r.push(e.value),i.push(e.data))}),r.length&&o.push({column:e,property:t,values:r,datas:i}))}),o}}),o)},setupGrid:function(e){return e.extendTableMethods(tableFilterMethodKeys)}},_default=tableFilterHook;exports.default=_default;
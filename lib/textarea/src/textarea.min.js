"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var autoTxtElem,_vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_utils=require("../../tools/utils"),_size=require("../../hooks/size");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default2=(0,_vue.defineComponent)({name:"VxeTextarea",props:{modelValue:[String,Number],className:String,immediate:{type:Boolean,default:!0},name:String,readonly:Boolean,disabled:Boolean,placeholder:String,maxlength:[String,Number],rows:{type:[String,Number],default:2},cols:{type:[String,Number],default:null},showWordCount:Boolean,countMethod:Function,autosize:[Boolean,Object],form:String,resize:{type:String,default:function(){return _conf.default.textarea.resize}},size:{type:String,default:function(){return _conf.default.textarea.size||_conf.default.size}}},emits:["update:modelValue","input","keydown","keyup","click","change","focus","blur"],setup:function(v,e){var a=e.emit,t=_xeUtils.default.uniqueId(),x=(0,_size.useSize)(v),_=(0,_vue.reactive)({inputValue:v.modelValue}),h=(0,_vue.ref)(),g=(0,_vue.ref)(),u={refElem:h,refTextarea:g},n={xID:t,props:v,context:e,reactData:_,getRefMaps:function(){return u}},l={},b=(0,_vue.computed)(function(){return _xeUtils.default.getSize(_.inputValue)}),z=(0,_vue.computed)(function(){var e=b.value;return v.maxlength&&e>_xeUtils.default.toNumber(v.maxlength)}),c=(0,_vue.computed)(function(){return Object.assign({minRows:1,maxRows:10},_conf.default.textarea.autosize,v.autosize)}),i=function(){var e=v.size,t=v.autosize,u=_.inputValue;if(t){autoTxtElem||(autoTxtElem=document.createElement("div")),autoTxtElem.parentNode||document.body.appendChild(autoTxtElem);var a=g.value,n=getComputedStyle(a);autoTxtElem.className=["vxe-textarea--autosize",e?"size--"+e:""].join(" "),autoTxtElem.style.width=a.clientWidth+"px",autoTxtElem.style.padding=n.padding,autoTxtElem.innerHTML=(""+(u||"　")).replace(/\n$/,"\n　")}},o=function(){v.autosize&&(0,_vue.nextTick)(function(){var e=c.value,t=e.minRows,u=e.maxRows,a=g.value,n=autoTxtElem.clientHeight,l=getComputedStyle(a),i=_xeUtils.default.toNumber(l.lineHeight),o=_xeUtils.default.toNumber(l.paddingTop)+_xeUtils.default.toNumber(l.paddingBottom)+_xeUtils.default.toNumber(l.borderTopWidth)+_xeUtils.default.toNumber(l.borderBottomWidth),r=(n-o)/i,s=r&&/[0-9]/.test(""+r)?r:Math.floor(r)+1,d=s;s<t?d=t:u<s&&(d=u),a.style.height=d*i+o+"px"})},y=function(e){var t=_.inputValue;n.dispatchEvent(e.type,{value:t},e)},r=function(e,t){_.inputValue=e,a("update:modelValue",e),_xeUtils.default.toValueString(v.modelValue)!==e&&l.dispatchEvent("change",{value:e},t)},T=function(e){var t=v.immediate,u=e.target.value;_.inputValue=u,t&&r(u,e),n.dispatchEvent("input",{value:u},e),o()},V=function(e){v.immediate?y(e):r(_.inputValue,e)},N=function(e){var t=v.immediate,u=_.inputValue;t||r(u,e),n.dispatchEvent("blur",{value:u},e)};l={dispatchEvent:function(e,t,u){a(e,Object.assign({$textarea:n,$event:u},t))},focus:function(){return g.value.focus(),(0,_vue.nextTick)()},blur:function(){return g.value.blur(),(0,_vue.nextTick)()}},Object.assign(n,l),(0,_vue.watch)(function(){return v.modelValue},function(e){_.inputValue=e,i()}),(0,_vue.nextTick)(function(){v.autosize&&(i(),o())});return n.renderVN=function(){var e,t=v.className,u=v.resize,a=v.placeholder,n=v.disabled,l=v.maxlength,i=v.autosize,o=v.showWordCount,r=v.countMethod,s=v.rows,d=v.cols,c=_.inputValue,f=x.value,m=z.value,p=b.value;return(0,_vue.h)("div",{ref:h,class:["vxe-textarea",t,(e={},e["size--"+f]=f,e["is--autosize"]=i,e["is--disabled"]=n,e["def--rows"]=!_xeUtils.default.eqNull(s),e["def--cols"]=!_xeUtils.default.eqNull(d),e)]},[(0,_vue.h)("textarea",{ref:g,class:"vxe-textarea--inner",value:c,name:v.name,placeholder:a?(0,_utils.getFuncText)(a):null,maxlength:l,readonly:v.readonly,disabled:n,rows:s,cols:d,style:u?{resize:u}:null,onInput:T,onChange:V,onKeydown:y,onKeyup:y,onClick:y,onFocus:y,onBlur:N}),o?(0,_vue.h)("span",{class:["vxe-textarea--count",{"is--error":m}]},r?""+r({value:c}):p+(l?"/"+l:"")):null])},n},render:function(){return this.renderVN()}});exports.default=_default2;
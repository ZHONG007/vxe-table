"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=require("../../hooks/size"),_dom=require("../../tools/dom"),_utils=require("../../tools/utils"),_event=require("../../tools/event");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default2=(0,_vue.defineComponent)({name:"VxePulldown",props:{disabled:Boolean,placement:String,size:{type:String,default:function(){return _conf.default.size}},destroyOnClose:Boolean,transfer:Boolean},emits:["hide-panel"],setup:function(x,e){var t,f=e.slots,i=e.emit,n=_xeUtils.default.uniqueId(),c=(0,_size.useSize)(x),h=(0,_vue.reactive)({inited:!1,panelIndex:0,panelStyle:null,panelPlacement:null,visiblePanel:!1,animatVisible:!1,isActivated:!1}),p=(0,_vue.ref)(),g=(0,_vue.ref)(),P=(0,_vue.ref)(),l={refElem:p},_={xID:n,props:x,context:e,reactData:h,getRefMaps:function(){return l}},o={},a=function(){return(0,_vue.nextTick)().then(function(){var e=x.transfer,t=x.placement,n=h.panelIndex;if(h.visiblePanel){var i=g.value,l=P.value;if(l&&i){var o=i.offsetHeight,a=i.offsetWidth,u=l.offsetHeight,s=l.offsetWidth,r={zIndex:n},d=(0,_dom.getAbsolutePos)(i),v=d.boundingTop,f=d.boundingLeft,c=d.visibleHeight,p=d.visibleWidth,_="bottom";if(e){var b=f,m=v+o;"top"===t?(_="top",m=v-u):t||(c<m+u+5&&(_="top",m=v-u),m<5&&(_="bottom",m=v+o)),p<b+s+5&&(b-=b+s+5-p),b<5&&(b=5),Object.assign(r,{left:b+"px",top:m+"px",minWidth:a+"px"})}else"top"===t?(_="top",r.bottom=o+"px"):t||c<v+o+u&&5<v-o-u&&(_="top",r.bottom=o+"px");h.panelStyle=r,h.panelPlacement=_}}return(0,_vue.nextTick)()})},u=function(){return h.inited||(h.inited=!0),new Promise(function(e){x.disabled?e((0,_vue.nextTick)()):(clearTimeout(t),h.isActivated=!0,h.animatVisible=!0,setTimeout(function(){h.visiblePanel=!0,a(),setTimeout(function(){e(a())},40)},10),h.panelIndex<(0,_utils.getLastZIndex)()&&(h.panelIndex=(0,_utils.nextZIndex)()))})},s=function(){return h.visiblePanel=!1,new Promise(function(e){h.animatVisible?t=window.setTimeout(function(){h.animatVisible=!1,e((0,_vue.nextTick)())},350):e((0,_vue.nextTick)())})},r=function(e){var t=x.disabled,n=h.visiblePanel,i=P.value;t||n&&((0,_dom.getEventTargetNode)(e,i).flag?a():(s(),o.dispatchEvent("hide-panel",{},e)))},d=function(e){var t=x.disabled,n=h.visiblePanel,i=p.value,l=P.value;t||(h.isActivated=(0,_dom.getEventTargetNode)(e,i).flag||(0,_dom.getEventTargetNode)(e,l).flag,n&&!h.isActivated&&(s(),o.dispatchEvent("hide-panel",{},e)))},v=function(e){h.visiblePanel&&(h.isActivated=!1,s(),o.dispatchEvent("hide-panel",{},e))};o={dispatchEvent:function(e,t,n){i(e,Object.assign({$pulldown:_,$event:n},t))},isPanelVisible:function(){return h.visiblePanel},togglePanel:function(){return h.visiblePanel?s():u()},showPanel:u,hidePanel:s},Object.assign(_,o),(0,_vue.nextTick)(function(){_event.GlobalEvent.on(_,"mousewheel",r),_event.GlobalEvent.on(_,"mousedown",d),_event.GlobalEvent.on(_,"blur",v)}),(0,_vue.onUnmounted)(function(){_event.GlobalEvent.off(_,"mousewheel"),_event.GlobalEvent.off(_,"mousedown"),_event.GlobalEvent.off(_,"blur")});return _.renderVN=function(){var e,t,n=x.destroyOnClose,i=x.transfer,l=x.disabled,o=h.inited,a=h.isActivated,u=h.animatVisible,s=h.visiblePanel,r=h.panelStyle,d=h.panelPlacement,v=c.value;return(0,_vue.h)("div",{ref:p,class:["vxe-pulldown",(e={},e["size--"+v]=v,e["is--visivle"]=s,e["is--disabled"]=l,e["is--active"]=a,e)]},[(0,_vue.h)("div",{ref:g,class:"vxe-pulldown--content"},f.default?f.default({$pulldown:_}):[]),(0,_vue.h)(_vue.Teleport,{to:"body",disabled:!i||!o},[(0,_vue.h)("div",{ref:P,class:["vxe-table--ignore-clear vxe-pulldown--panel",(t={},t["size--"+v]=v,t["is--transfer"]=i,t["animat--leave"]=u,t["animat--enter"]=s,t)],placement:d,style:r},f.dropdown?[(0,_vue.h)("div",{class:"vxe-pulldown--wrapper"},!o||n&&!s&&!u?[]:f.dropdown({$pulldown:_}))]:[])])])},_},render:function(){return this.renderVN()}});exports.default=_default2;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_util=require("../../table/src/util"),_dom=require("../../tools/dom");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,l=1,o=arguments.length;l<o;l++)for(var r in t=arguments[l])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},renderType="footer";function mergeFooterMethod(e,t,l){for(var o=0;o<e.length;o++){var r=e[o],n=r.row,a=r.col,i=r.rowspan,u=r.colspan;if(-1<a&&-1<n&&i&&u){if(n===t&&a===l)return{rowspan:i,colspan:u};if(n<=t&&t<n+i&&a<=l&&l<a+u)return{rowspan:0,colspan:0}}}}var _default2=(0,_vue.defineComponent)({name:"VxeTableFooter",props:{footerTableData:{type:Array,default:function(){return[]}},tableColumn:{type:Array,default:function(){return[]}},fixedColumn:{type:Array,default:function(){return[]}},fixedType:{type:String,default:null}},setup:function(d){var K=(0,_vue.inject)("$xetable",{}),n=K.xID,a=K.props,p=K.reactData,v=K.internalData,e=K.getRefMaps(),_=e.refTableHeader,x=e.refTableBody,g=e.refValidTooltip,i=K.getComputeMaps().computeTooltipOpts,m=(0,_vue.ref)(),u=(0,_vue.ref)(),s=(0,_vue.ref)(),c=(0,_vue.ref)(),f=(0,_vue.ref)(),y=function(e){var t=d.fixedType,l=p.scrollXLoad,o=v.lastScrollLeft,r=g.value,n=_.value,a=x.value,i=n?n.$el:null,u=m.value,s=a.$el,c=u.scrollLeft,f=c!==o;v.lastScrollLeft=c,v.lastScrollTime=Date.now(),i&&(i.scrollLeft=c),s&&(s.scrollLeft=c),l&&f&&K.triggerScrollXEvent(e),f&&r&&r.reactData.visible&&r.updatePlacement(),K.dispatchEvent("scroll",{type:renderType,fixed:t,scrollTop:s.scrollTop,scrollLeft:c,isX:f,isY:!1},e)};(0,_vue.nextTick)(function(){var e=d.fixedType,t=v.elemStore,l=(e||"main")+"-footer-";t[l+"wrapper"]=m.value,t[l+"table"]=u.value,t[l+"colgroup"]=s.value,t[l+"list"]=c.value,t[l+"xSpace"]=f.value});return function(){var M=d.fixedType,e=d.fixedColumn,O=d.tableColumn,k=d.footerTableData,t=a.footerRowClassName,U=a.footerCellClassName,l=a.footerRowStyle,j=a.footerCellStyle,q=a.footerAlign,A=a.footerSpanMethod,E=a.align,N=a.columnKey,P=a.showFooterOverflow,o=v.visibleColumn,R=p.scrollXLoad,X=p.overflowX,r=p.scrollbarWidth,V=p.currentColumn,B=p.mergeFooterList,H=i.value;return M&&(O=R||P?B.length&&A?o:e:o),(0,_vue.h)("div",{ref:m,class:["vxe-table--footer-wrapper",M?"fixed-"+M+"--wrapper":"body--wrapper"],xid:n,onScroll:y},[M?(0,_vue.createCommentVNode)():(0,_vue.h)("div",{ref:f,class:"vxe-body--x-space"}),(0,_vue.h)("table",{ref:u,class:"vxe-table--footer",xid:n,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("colgroup",{ref:s},O.map(function(e,t){return(0,_vue.h)("col",{name:e.id,key:t})}).concat(r?[(0,_vue.h)("col",{name:"col_gutter"})]:[])),(0,_vue.h)("tfoot",{ref:c},k.map(function(D,L){var $=L;return(0,_vue.h)("tr",{class:["vxe-footer--row",t?_xeUtils.default.isFunction(t)?t({$table:K,_rowIndex:L,$rowIndex:$,fixed:M,type:renderType}):t:""],style:l?_xeUtils.default.isFunction(l)?l({$table:K,_rowIndex:L,$rowIndex:$,fixed:M,type:renderType}):l:null},O.map(function(t,e){var l,o=t.type,r=t.showFooterOverflow,n=t.footerAlign,a=t.align,i=t.footerClassName,u=H.showAll,s=t.children&&t.children.length,c=M?t.fixed!==M&&!s:t.fixed&&X,f=_xeUtils.default.isUndefined(r)||_xeUtils.default.isNull(r)?P:r,d=n||a||q||E,p="ellipsis"===f,v="title"===f,_=!0===f||"tooltip"===f,x=v||_||p,g={colid:t.id},m={},y=K.getColumnIndex(t),h=K.getVTColumnIndex(t),b={$table:K,_rowIndex:L,$rowIndex:$,column:t,columnIndex:y,$columnIndex:e,_columnIndex:h,itemIndex:h,items:D,fixed:M,type:renderType,data:k};if(R&&!x&&(p=x=!0),(v||_||u)&&(m.onMouseenter=function(e){v?(0,_dom.updateCellTitle)(e.currentTarget,t):(_||u)&&K.triggerFooterTooltipEvent(e,b)}),(_||u)&&(m.onMouseleave=function(e){(_||u)&&K.handleTargetLeaveEvent(e)}),m.onClick=function(e){K.dispatchEvent("footer-cell-click",Object.assign({cell:e.currentTarget},b),e)},m.onDblclick=function(e){K.dispatchEvent("footer-cell-dblclick",Object.assign({cell:e.currentTarget},b),e)},B.length){var w=mergeFooterMethod(B,L,h);if(w){var T=w.rowspan,C=w.colspan;if(!T||!C)return null;1<T&&(g.rowspan=T),1<C&&(g.colspan=C)}}else if(A){var I=A(b)||{},F=I.rowspan,S=(T=void 0===F?1:F,I.colspan);if(C=void 0===S?1:S,!T||!C)return null;1<T&&(g.rowspan=T),1<C&&(g.colspan=C)}return(0,_vue.h)("td",__assign(__assign(__assign(__assign({class:["vxe-footer--column",t.id,(l={},l["col--"+d]=d,l["col--"+o]=o,l["col--last"]=e===O.length-1,l["fixed--hidden"]=c,l["col--ellipsis"]=x,l["col--current"]=V===t,l),(0,_util.getPropClass)(i,b),(0,_util.getPropClass)(U,b)]},g),{style:j?_xeUtils.default.isFunction(j)?j(b):j:null}),m),{key:N?t.id:e}),[(0,_vue.h)("div",{class:["vxe-cell",{"c--title":v,"c--tooltip":_,"c--ellipsis":p}]},t.renderFooter(b))])}).concat(r?[(0,_vue.h)("td",{class:"vxe-footer--gutter col--gutter"})]:[]))}))])])}}});exports.default=_default2;
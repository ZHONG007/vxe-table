"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=require("../../v-x-e-table"),_size=require("../../hooks/size"),_dom=require("../../tools/dom"),_utils=require("../../tools/utils"),_event=require("../../tools/event");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var i in t=arguments[o])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},_default2=(0,_vue.defineComponent)({name:"VxeToolbar",props:{loading:Boolean,refresh:[Boolean,Object],import:[Boolean,Object],export:[Boolean,Object],print:[Boolean,Object],zoom:[Boolean,Object],custom:[Boolean,Object],buttons:{type:Array,default:function(){return _conf.default.toolbar.buttons}},tools:{type:Array,default:function(){return _conf.default.toolbar.tools}},perfect:{type:Boolean,default:function(){return _conf.default.toolbar.perfect}},size:{type:String,default:function(){return _conf.default.toolbar.size||_conf.default.size}},className:[String,Function]},emits:["button-click","tool-click"],setup:function(d,e){var t,_,b=e.slots,n=e.emit,o=_xeUtils.default.uniqueId(),p=(0,_size.useSize)(d),m=(0,_vue.reactive)({isRefresh:!1,columns:[]}),h=(0,_vue.ref)(),x=(0,_vue.ref)(),O=(0,_vue.reactive)({isAll:!1,isIndeterminate:!1,activeBtn:!1,activeWrapper:!1,visible:!1}),i={refElem:h},g={xID:o,props:d,context:e,reactData:m,getRefMaps:function(){return i}},T=(0,_vue.inject)("$xegrid",null),C=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.refresh,d.refresh)}),k=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.import,d.import)}),y=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.export,d.export)}),R=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.print,d.print)}),E=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.zoom,d.zoom)}),B=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.custom,d.custom)}),c=function(){if(_)return!0;(0,_utils.errLog)("vxe.error.barUnableLink")},r=function(){var e=m.columns,t=_.getComputeMaps().computeCustomOpts.value.checkMethod;O.isAll=e.every(function(e){return!!t&&!t({column:e})||e.visible}),O.isIndeterminate=!O.isAll&&e.some(function(e){return(!t||t({column:e}))&&(e.visible||e.halfVisible)})},u=function(){_.handleCustom()},l=function(){var e=d.custom,t=B.value;O.visible&&(O.visible=!1,e&&!t.immediate&&u())},a=function(e,t){(T||_).dispatchEvent("custom",{type:e},t)},M=function(e){l(),a("confirm",e)},s=function(e){c()&&(O.visible||(O.visible=!0,r(),a("open",e)))},v=function(e){O.visible&&(l(),a("close",e))},V=function(e){var t=m.columns,o=_.getComputeMaps().computeCustomOpts.value.checkMethod;_xeUtils.default.eachTree(t,function(e){o&&!o({column:e})||(e.visible=e.defaultVisible,e.halfVisible=!1),e.resizeWidth=0}),_.saveCustomResizable(!0),l(),a("reset",e)},L=function(e){var t=!e.visible,o=B.value;_xeUtils.default.eachTree([e],function(e){e.visible=t,e.halfVisible=!1}),function e(t){var o=m.columns,n=_xeUtils.default.findTree(o,function(e){return e===t});if(n&&n.parent){var i=n.parent;i.children&&i.children.length&&(i.visible=i.children.every(function(e){return e.visible}),i.halfVisible=!i.visible&&i.children.some(function(e){return e.visible||e.halfVisible}),e(i))}}(e),d.custom&&o.immediate&&u(),r()},j=function(){var e=m.columns,t=_.getComputeMaps().computeCustomOpts.value.checkMethod,o=!O.isAll;_xeUtils.default.eachTree(e,function(e){t&&!t({column:e})||(e.visible=o,e.halfVisible=!1)}),O.isAll=o,r()},f=function(e){var t=x.value;(0,_dom.getEventTargetNode)(e,t).flag||v(e)},A=function(e){v(e)},z=function(e){O.visible?v(e):s(e)},$=function(e){O.activeBtn=!0,s(e)},q=function(e){O.activeBtn=!1,setTimeout(function(){O.activeBtn||O.activeWrapper||v(e)},300)},N=function(e){O.activeWrapper=!0,s(e)},S=function(e){O.activeWrapper=!1,setTimeout(function(){O.activeBtn||O.activeWrapper||v(e)},300)},w=function(){var e=m.isRefresh,t=C.value;if(!e){var o=t.query;if(o){m.isRefresh=!0;try{Promise.resolve(o({})).catch(function(e){return e}).then(function(){m.isRefresh=!1})}catch(e){m.isRefresh=!1}}else T&&(m.isRefresh=!0,T.commitProxy("reload").catch(function(e){return e}).then(function(){m.isRefresh=!1}))}},U=function(e){T&&T.triggerZoomEvent(e)},I=function(e,t){var o=t.code;if(o)if(T)T.triggerToolbarBtnEvent(t,e);else{var n=_vXETable.VXETable.commands.get(o),i={code:o,button:t,$table:_,$event:e};n&&n(i,e),g.dispatchEvent("button-click",i,e)}},X=function(e,t){var o=t.code;if(o)if(T)T.triggerToolbarTolEvent(t,e);else{var n=_vXETable.VXETable.commands.get(o),i={code:o,tool:t,$table:_,$event:e};n&&n(i,e),g.dispatchEvent("tool-click",i,e)}},P=function(){c()&&_.openImport()},D=function(){c()&&_.openExport()},F=function(){c()&&_.openPrint()},W=function(e,o){var t=e.dropdowns;return t?t.map(function(t,e){return!1===t.visible?(0,_vue.createCommentVNode)():(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{key:e,disabled:t.disabled,loading:t.loading,type:t.type,icon:t.icon,circle:t.circle,round:t.round,status:t.status,content:t.name,onClick:function(e){return o?I(e,t):X(e,t)}})}):[]};t={dispatchEvent:function(e,t,o){n(e,Object.assign({$toolbar:g,$event:o},t))},syncUpdate:function(e){var t=e.collectColumn;_=e.$table,m.columns=t}},Object.assign(g,t),(0,_vue.onMounted)(function(){_event.GlobalEvent.on(g,"mousedown",f),_event.GlobalEvent.on(g,"blur",A)}),(0,_vue.onUnmounted)(function(){_event.GlobalEvent.off(g,"mousedown"),_event.GlobalEvent.off(g,"blur")}),(0,_vue.nextTick)(function(){var e=d.refresh,t=C.value;!e||T||t.query||(0,_utils.warnLog)("vxe.error.notFunc",["query"])});return g.renderVN=function(){var e,t=d.perfect,o=d.loading,n=d.refresh,i=d.zoom,c=d.custom,r=d.className,u=p.value,l=C.value,a=k.value,s=y.value,v=R.value,f=E.value;return(0,_vue.h)("div",{ref:h,class:["vxe-toolbar",r?_xeUtils.default.isFunction(r)?r({$toolbar:g}):r:"",(e={},e["size--"+u]=u,e["is--perfect"]=t,e["is--loading"]=o,e)]},[(0,_vue.h)("div",{class:"vxe-buttons--wrapper"},function(){var e=d.buttons,t=b.buttons;if(t)return t({$grid:T,$table:_});var i=[];return e&&e.forEach(function(t){var e=t.dropdowns,o=t.buttonRender;if(!1!==t.visible){var n=o?_vXETable.VXETable.renderer.get(o.name):null;o&&n&&n.renderToolbarButton?i.push((0,_vue.h)("span",{class:"vxe-button--item"},n.renderToolbarButton(o,{$grid:T,$table:_,button:t}))):i.push((0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{disabled:t.disabled,loading:t.loading,type:t.type,icon:t.icon,circle:t.circle,round:t.round,status:t.status,content:t.name,destroyOnClose:t.destroyOnClose,placement:t.placement,transfer:t.transfer,onClick:function(e){return I(e,t)}},e&&e.length?{dropdowns:function(){return W(t,!0)}}:{}))}}),i}()),(0,_vue.h)("div",{class:"vxe-tools--wrapper"},function(){var e=d.tools,t=b.tools;if(t)return t({$grid:T,$table:_});var i=[];return e&&e.forEach(function(t){var e=t.dropdowns,o=t.toolRender;if(!1!==t.visible){var n=o?_vXETable.VXETable.renderer.get(o.name):null;o&&n&&n.renderToolbarTool?i.push((0,_vue.h)("span",{class:"vxe-tool--item"},n.renderToolbarTool(o,{$grid:T,$table:_,tool:t}))):i.push((0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{disabled:t.disabled,loading:t.loading,type:t.type,icon:t.icon,circle:t.circle,round:t.round,status:t.status,content:t.name,destroyOnClose:t.destroyOnClose,placement:t.placement,transfer:t.transfer,onClick:function(e){return X(e,t)}},e&&e.length?{dropdowns:function(){return W(t,!1)}}:{}))}}),i}()),(0,_vue.h)("div",{class:"vxe-tools--operate"},[d.import?(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{circle:!0,icon:a.icon||_conf.default.icon.TOOLBAR_TOOLS_IMPORT,title:_conf.default.i18n("vxe.toolbar.import"),onClick:P}):(0,_vue.createCommentVNode)(),d.export?(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{circle:!0,icon:s.icon||_conf.default.icon.TOOLBAR_TOOLS_EXPORT,title:_conf.default.i18n("vxe.toolbar.export"),onClick:D}):(0,_vue.createCommentVNode)(),d.print?(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{circle:!0,icon:v.icon||_conf.default.icon.TOOLBAR_TOOLS_PRINT,title:_conf.default.i18n("vxe.toolbar.print"),onClick:F}):(0,_vue.createCommentVNode)(),n?(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{circle:!0,icon:m.isRefresh?l.iconLoading||_conf.default.icon.TOOLBAR_TOOLS_REFRESH_LOADING:l.icon||_conf.default.icon.TOOLBAR_TOOLS_REFRESH,title:_conf.default.i18n("vxe.toolbar.refresh"),onClick:w}):(0,_vue.createCommentVNode)(),i&&T?(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{circle:!0,icon:T.isMaximized()?f.iconOut||_conf.default.icon.TOOLBAR_TOOLS_ZOOM_OUT:f.iconIn||_conf.default.icon.TOOLBAR_TOOLS_ZOOM_IN,title:_conf.default.i18n("vxe.toolbar.zoom"+(T.isMaximized()?"Out":"In")),onClick:U}):(0,_vue.createCommentVNode)(),c?function(){var c,e=m.columns,t=B.value,r=[],o={},n={};if(_){var i=_.getComputeMaps().computeCustomOpts.value;c=i.checkMethod}return"manual"===t.trigger||("hover"===t.trigger?(o.onMouseenter=$,o.onMouseleave=q,n.onMouseenter=N,n.onMouseleave=S):o.onClick=z),_xeUtils.default.eachTree(e,function(e){var t=(0,_utils.formatText)(e.getTitle(),1),o=e.getKey(),n=e.children&&e.children.length,i=!!c&&!c({column:e});(n||o)&&r.push((0,_vue.h)("li",{class:["vxe-custom--option","level--"+e.level,{"is--group":n,"is--checked":e.visible,"is--indeterminate":e.halfVisible,"is--disabled":i}],title:t,onClick:function(){i||L(e)}},[(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--label"},t)]))}),(0,_vue.h)("div",{class:["vxe-custom--wrapper",{"is--active":O.visible}],ref:x},[(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),__assign({circle:!0,icon:t.icon||_conf.default.icon.TOOLBAR_TOOLS_CUSTOM,title:_conf.default.i18n("vxe.toolbar.custom")},o)),(0,_vue.h)("div",{class:"vxe-custom--option-wrapper"},[(0,_vue.h)("ul",{class:"vxe-custom--header"},[(0,_vue.h)("li",{class:["vxe-custom--option",{"is--checked":O.isAll,"is--indeterminate":O.isIndeterminate}],title:_conf.default.i18n("vxe.table.allTitle"),onClick:j},[(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--label"},_conf.default.i18n("vxe.toolbar.customAll"))])]),(0,_vue.h)("ul",__assign({class:"vxe-custom--body"},n),r),!1===t.isFooter?null:(0,_vue.h)("div",{class:"vxe-custom--footer"},[(0,_vue.h)("button",{class:"btn--confirm",onClick:M},_conf.default.i18n("vxe.toolbar.customConfirm")),(0,_vue.h)("button",{class:"btn--reset",onClick:V},_conf.default.i18n("vxe.toolbar.customRestore"))])])])}():(0,_vue.createCommentVNode)()])])},g},render:function(){return this.renderVN()}});exports.default=_default2;
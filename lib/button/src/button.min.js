"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=require("../../hooks/size"),_dom=require("../../tools/dom"),_utils=require("../../tools/utils"),_event=require("../../tools/event");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default2=(0,_vue.defineComponent)({name:"VxeButton",props:{type:String,className:String,size:{type:String,default:function(){return _conf.default.button.size||_conf.default.size}},name:[String,Number],content:String,placement:String,status:String,icon:String,round:Boolean,circle:Boolean,disabled:Boolean,loading:Boolean,destroyOnClose:Boolean,transfer:{type:Boolean,default:function(){return _conf.default.button.transfer}}},emits:["click","dropdown-click"],setup:function(x,e){var g=e.slots,o=e.emit,t=_xeUtils.default.uniqueId(),w=(0,_size.useSize)(x),T=(0,_vue.reactive)({inited:!1,showPanel:!1,animatVisible:!1,panelIndex:0,panelStyle:{},panelPlacement:""}),n={showTime:null},y=(0,_vue.ref)(),P=(0,_vue.ref)(),N=(0,_vue.ref)(),i={refElem:y},a={xID:t,props:x,context:e,reactData:T,internalData:n,getRefMaps:function(){return i}},u={},k=(0,_vue.computed)(function(){var e=x.type;return!!e&&-1<["submit","reset","button"].indexOf(e)}),z=(0,_vue.computed)(function(){var e=x.type;return e&&"text"===e?e:"button"}),s=function(){return(0,_vue.nextTick)().then(function(){var e=x.transfer,t=x.placement,n=T.panelIndex,o=P.value,i=N.value;if(i&&o){var a=o.offsetHeight,u=o.offsetWidth,s=i.offsetHeight,l=i.offsetWidth,r={zIndex:n},c=(0,_dom.getAbsolutePos)(o),d=c.boundingTop,v=c.boundingLeft,f=c.visibleHeight,p=c.visibleWidth,m="bottom";if(e){var _=v+u-l,b=d+a;"top"===t?(m="top",b=d-s):t||(f<b+s+5&&(m="top",b=d-s),b<5&&(m="bottom",b=d+a)),p<_+l+5&&(_-=_+l+5-p),_<5&&(_=5),Object.assign(r,{left:_+"px",right:"auto",top:b+"px",minWidth:u+"px"})}else"top"===t?(m="top",r.bottom=a+"px"):t||f<d+a+s&&5<d-a-s&&(m="top",r.bottom=a+"px");return T.panelStyle=r,T.panelPlacement=m,(0,_vue.nextTick)()}})},O=function(e){u.dispatchEvent("click",{$event:e},e)},S=function(e){0===e.button&&e.stopPropagation()},q=function(e){var t=e.currentTarget,n=N.value,o=(0,_dom.getEventTargetNode)(e,t,"vxe-button"),i=o.flag,a=o.targetElem;i&&(n&&(n.dataset.active="N"),T.showPanel=!1,setTimeout(function(){n&&"Y"===n.dataset.active||(T.animatVisible=!1)},350),u.dispatchEvent("dropdown-click",{name:a.getAttribute("name"),$event:e},e))},I=function(){var e=N.value;e&&(e.dataset.active="Y",T.animatVisible=!0,setTimeout(function(){"Y"===e.dataset.active&&(T.showPanel=!0,T.panelIndex<(0,_utils.getLastZIndex)()&&(T.panelIndex=(0,_utils.nextZIndex)()),s(),setTimeout(function(){T.showPanel&&s()},50))},20))},V=function(){var e=N.value;e&&(e.dataset.active="Y",T.inited||(T.inited=!0),n.showTime=setTimeout(function(){"Y"===e.dataset.active?I():T.animatVisible=!1},250))},l=function(){var e=N.value;clearTimeout(n.showTime),e?(e.dataset.active="N",setTimeout(function(){"Y"!==e.dataset.active&&(T.showPanel=!1,setTimeout(function(){"Y"!==e.dataset.active&&(T.animatVisible=!1)},350))},100)):(T.animatVisible=!1,T.showPanel=!1)},B=function(){l()},D=function(){var e=x.content,t=x.icon,n=[];return x.loading?n.push((0,_vue.h)("i",{class:["vxe-button--loading-icon",_conf.default.icon.BUTTON_LOADING]})):t&&n.push((0,_vue.h)("i",{class:["vxe-button--icon",t]})),g.default?n.push((0,_vue.h)("span",{class:"vxe-button--content"},g.default({}))):e&&n.push((0,_vue.h)("span",{class:"vxe-button--content"},(0,_utils.getFuncText)(e))),n};u={dispatchEvent:function(e,t,n){o(e,Object.assign({$button:a,$event:n},t))},focus:function(){return P.value.focus(),(0,_vue.nextTick)()},blur:function(){return P.value.blur(),(0,_vue.nextTick)()}},Object.assign(a,u),(0,_vue.onMounted)(function(){_event.GlobalEvent.on(a,"mousewheel",function(e){var t=N.value;T.showPanel&&!(0,_dom.getEventTargetNode)(e,t).flag&&l()})}),(0,_vue.onUnmounted)(function(){_event.GlobalEvent.off(a,"mousewheel")});return a.renderVN=function(){var e,t,n,o,i=x.className,a=x.transfer,u=x.type,s=x.round,l=x.circle,r=x.destroyOnClose,c=x.status,d=x.name,v=x.disabled,f=x.loading,p=T.inited,m=T.showPanel,_=k.value,b=z.value,h=w.value;return g.dropdowns?(0,_vue.h)("div",{ref:y,class:["vxe-button--dropdown",i,(e={},e["size--"+h]=h,e["is--active"]=m,e)]},[(0,_vue.h)("button",{ref:P,class:["vxe-button","type--"+b,(t={},t["size--"+h]=h,t["theme--"+c]=c,t["is--round"]=s,t["is--circle"]=l,t["is--disabled"]=v||f,t["is--loading"]=f,t)],name:d,type:_?u:"button",disabled:v||f,onMouseenter:V,onMouseleave:B,onClick:O},D().concat([(0,_vue.h)("i",{class:"vxe-button--dropdown-arrow "+_conf.default.icon.BUTTON_DROPDOWN})])),(0,_vue.h)(_vue.Teleport,{to:"body",disabled:!a||!p},[(0,_vue.h)("div",{ref:N,class:["vxe-button--dropdown-panel",(n={},n["size--"+h]=h,n["animat--leave"]=T.animatVisible,n["animat--enter"]=m,n)],placement:T.panelPlacement,style:T.panelStyle},p?[(0,_vue.h)("div",{class:"vxe-button--dropdown-wrapper",onMousedown:S,onClick:q,onMouseenter:I,onMouseleave:B},r&&!m?[]:g.dropdowns({}))]:[])])]):(0,_vue.h)("button",{ref:P,class:["vxe-button","type--"+b,(o={},o["size--"+h]=h,o["theme--"+c]=c,o["is--round"]=s,o["is--circle"]=l,o["is--disabled"]=v||f,o["is--loading"]=f,o)],name:d,type:_?u:"button",disabled:v||f,onClick:O},D())},a},render:function(){return this.renderVN()}});exports.default=_default2;
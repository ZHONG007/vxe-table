"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=require("../../v-x-e-table"),_util=require("./util"),_dom=require("../../tools/dom"),_utils=require("../../tools/utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var l,t=1,o=arguments.length;t<o;t++)for(var r in l=arguments[t])Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);return e}).apply(this,arguments)},__spreadArray=function(e,l){for(var t=0,o=l.length,r=e.length;t<o;t++,r++)e[r]=l[t];return e},renderType="body",lineOffsetSizes={mini:3,small:2,medium:1},_default=(0,_vue.defineComponent)({name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,fixedColumn:Array,fixedType:{type:String,default:null}},setup:function(R){var o,g,Oe=(0,_vue.inject)("$xetable",{}),l=(0,_vue.inject)("xesize",null),w=Oe.xID,Re=Oe.props,b=Oe.context,Ee=Oe.reactData,Ie=Oe.internalData,e=Oe.getRefMaps(),E=e.refTableHeader,I=e.refTableBody,$=e.refTableFooter,M=e.refTableLeftBody,H=e.refTableRightBody,D=e.refValidTooltip,t=Oe.getComputeMaps(),$e=t.computeEditOpts,T=t.computeMouseOpts,Me=t.computeSYOpts,S=t.computeEmptyOpts,C=t.computeKeyboardOpts,He=t.computeTooltipOpts,A=t.computeRadioOpts,De=t.computeTreeOpts,ke=t.computeCheckboxOpts,qe=t.computeValidOpts,k=(0,_vue.ref)(),L=(0,_vue.ref)(),O=(0,_vue.ref)(),q=(0,_vue.ref)(),U=(0,_vue.ref)(),Y=(0,_vue.ref)(),B=(0,_vue.ref)(),Ue=function(){if(l){var e=l.value;if(e)return lineOffsetSizes[e]||0}return 0},Ye=function(e,l){var t=e.$rowIndex,o=1;return t&&(o=function e(l,t){var o=l[De.value.children],r=1;if(Oe.isTreeExpandByRow(l))for(var a=0;a<o.length;a++)r+=e(o[a],t);return r}(l[t-1],e)),Ee.rowHeight*o-(t?1:12-Ue())},Be=function(){var e=Re.delayHover,l=Ie.lastScrollTime;return Ie._isResize||l&&Date.now()<l+e},j=function(e,l,t,o,r,a,n,i,s,u,c,d,v){var p,f,h=Re.columnKey,x=Re.height,g=Re.showOverflow,_=Re.cellClassName,m=Re.cellStyle,y=Re.align,w=Re.spanMethod,b=Re.mouseConfig,T=Re.editConfig,S=Re.editRules,C=Re.tooltipConfig,L=Ee.tableData,O=Ee.overflowX,R=Ee.scrollXLoad,E=Ee.scrollYLoad,I=Ee.currentColumn,$=Ee.mergeList,M=Ee.editStore,H=Ee.validStore,D=Ee.isAllOverflow,k=Ie.afterFullData,q=qe.value,U=ke.value,Y=$e.value,B=He.value,X=Me.value,A=u.type,j=u.cellRender,N=u.editRender,V=u.align,F=u.showOverflow,W=u.className,P=u.treeNode,z=M.actived,K=X.rHeight,G=B.showAll,J=Oe.getColumnIndex(u),Q=Oe.getVTColumnIndex(u),Z=(0,_utils.isEnableConf)(N),ee=o?u.fixed!==o:u.fixed&&O,le=_xeUtils.default.isUndefined(F)||_xeUtils.default.isNull(F)?g:F,te="ellipsis"===le,oe="title"===le,re=!0===le||"tooltip"===le,ae=oe||re||te,ne={},ie=V||y,se=H.row===a&&H.column===u,ue=S&&q.showMessage&&("default"===q.message?x||1<L.length:"inline"===q.message),ce={colid:u.id},de={$table:Oe,$seq:e,seq:l,rowid:t,row:a,rowIndex:n,$rowIndex:i,_rowIndex:s,column:u,columnIndex:J,$columnIndex:c,_columnIndex:Q,fixed:o,type:renderType,isHidden:ee,level:r,visibleData:k,data:L,items:v};if(!R&&!E||ae||(te=ae=!0),(oe||re||G||C)&&(ne.onMouseenter=function(e){Be()||(oe?(0,_dom.updateCellTitle)(e.currentTarget,u):(re||G)&&Oe.triggerBodyTooltipEvent(e,de),Oe.dispatchEvent("cell-mouseenter",Object.assign({cell:e.currentTarget},de),e))}),(re||G||C)&&(ne.onMouseleave=function(e){Be()||((re||G)&&Oe.handleTargetLeaveEvent(e),Oe.dispatchEvent("cell-mouseleave",Object.assign({cell:e.currentTarget},de),e))}),(U.range||b)&&(ne.onMousedown=function(e){Oe.triggerCellMousedownEvent(e,de)}),ne.onClick=function(e){Oe.triggerCellClickEvent(e,de)},ne.onDblclick=function(e){Oe.triggerCellDblclickEvent(e,de)},$.length){var ve=(0,_util.mergeBodyMethod)($,s,Q);if(ve){var pe=ve.rowspan,fe=ve.colspan;if(!pe||!fe)return null;1<pe&&(ce.rowspan=pe),1<fe&&(ce.colspan=fe)}}else if(w){var he=w(de)||{},xe=he.rowspan,ge=(pe=void 0===xe?1:xe,he.colspan);fe=void 0===ge?1:ge;if(!pe||!fe)return null;1<pe&&(ce.rowspan=pe),1<fe&&(ce.colspan=fe)}ee&&$&&(1<ce.colspan||1<ce.rowspan)&&(ee=!1),!ee&&T&&(N||j)&&(Y.showStatus||Y.showUpdateStatus)&&(f=Oe.isUpdateByRow(a,u.property));var _e,me,ye,we,be,Te,Se,Ce,Le=[];return ee&&(g?D:g)?Le.push((0,_vue.h)("div",{class:["vxe-cell",{"c--title":oe,"c--tooltip":re,"c--ellipsis":te}],style:{maxHeight:ae&&K?K+"px":""}})):(Le.push.apply(Le,__spreadArray(__spreadArray([],(_e=r,me=v,we=(ye=de).column,be=Re.treeConfig,Te=De.value,Se=we.slots,Ce=we.treeNode,Se&&Se.line?Oe.callSlot(Se.line,ye):be&&Ce&&Te.line?[(0,_vue.h)("div",{class:"vxe-tree--line-wrapper"},[(0,_vue.h)("div",{class:"vxe-tree--line",style:{height:Ye(ye,me)+"px",left:_e*Te.indent+(_e?2-Ue():0)+16+"px"}})])]:[])),[(0,_vue.h)("div",{class:["vxe-cell",{"c--title":oe,"c--tooltip":re,"c--ellipsis":te}],style:{maxHeight:ae&&K?K+"px":""},title:oe?Oe.getCellLabel(a,u):null},u.renderCell(de))])),ue&&se&&Le.push((0,_vue.h)("div",{class:"vxe-cell--valid",style:H.rule&&H.rule.maxWidth?{width:H.rule.maxWidth+"px"}:null},[(0,_vue.h)("span",{class:"vxe-cell--valid-msg"},H.content)]))),(0,_vue.h)("td",__assign(__assign(__assign({class:["vxe-body--column",u.id,(p={},p["col--"+ie]=ie,p["col--"+A]=A,p["col--last"]=c===d.length-1,p["col--tree-node"]=P,p["col--edit"]=Z,p["col--ellipsis"]=ae,p["fixed--hidden"]=ee,p["col--dirty"]=f,p["col--actived"]=T&&Z&&z.row===a&&(z.column===u||"row"===Y.mode),p["col--valid-error"]=se,p["col--current"]=I===u,p),(0,_util.getPropClass)(W,de),(0,_util.getPropClass)(_,de)],key:h?u.id:c},ce),{style:Object.assign({height:ae&&K?K+"px":""},m?_xeUtils.default.isFunction(m)?m(de):m:null)}),ne),Le)},X=function(e,l,t){(l||t)&&(l&&((0,_util.removeScrollListener)(l),l.scrollTop=e),t&&((0,_util.removeScrollListener)(t),t.scrollTop=e),clearTimeout(o),o=setTimeout(function(){(0,_util.restoreScrollListener)(l),(0,_util.restoreScrollListener)(t)},300))},r=function(e){var l=R.fixedType,t=Re.highlightHoverRow,o=Ee.scrollXLoad,r=Ee.scrollYLoad,a=Ie.elemStore,n=Ie.lastScrollTop,i=Ie.lastScrollLeft,s=E.value,u=I.value,c=$.value,d=M.value,v=H.value,p=D.value,f=k.value,h=s?s.$el:null,x=c?c.$el:null,g=u.$el,_=d?d.$el:null,m=v?v.$el:null,y=a["main-body-ySpace"],w=a["main-body-xSpace"],b=y?y.clientHeight:0,T=w?w.clientWidth:0,S=f.scrollTop,C=g.scrollLeft,L=C!==i,O=S!==n;Ie.lastScrollTop=S,Ie.lastScrollLeft=C,Ie.lastScrollTime=Date.now(),t&&Oe.clearHoverRow(),_&&"left"===l?(S=_.scrollTop,X(S,g,m)):m&&"right"===l?(S=m.scrollTop,X(S,g,_)):(L&&(h&&(h.scrollLeft=g.scrollLeft),x&&(x.scrollLeft=g.scrollLeft)),(_||m)&&(Oe.checkScrolling(),O&&X(S,_,m))),o&&L&&Oe.triggerScrollXEvent(e),r&&O&&Oe.triggerScrollYEvent(e),L&&p&&p.reactData.visible&&p.updatePlacement(),Oe.dispatchEvent("scroll",{type:renderType,fixed:l,scrollTop:S,scrollLeft:C,bodyHeight:b,bodyWidth:T,isX:L,isY:O},e)},_=0,m=0,y=0,N=!1,V=function(e){var l=e.deltaY,t=e.deltaX,o=Re.highlightHoverRow,r=Ee.scrollYLoad,a=Ie.lastScrollTop,n=Ie.lastScrollLeft,i=I.value,s=k.value,u=i.$el,c=_dom.browse.firefox?40*l:l,d=_dom.browse.firefox?40*t:t,v=c<0;if(!(v?s.scrollTop<=0:s.scrollTop>=s.scrollHeight-s.clientHeight)){var p=s.scrollTop+c,f=u.scrollLeft+d,h=f!==n,x=p!==a;x&&(e.preventDefault(),Ie.lastScrollTop=p,Ie.lastScrollLeft=f,Ie.lastScrollTime=Date.now(),o&&Oe.clearHoverRow(),function(n,i,e,s,u){var l=Ie.elemStore,t=I.value,o=M.value,r=H.value,c=o?o.$el:null,d=r?r.$el:null,v=t.$el,a=l["main-body-ySpace"],p=l["main-body-xSpace"],f=a?a.clientHeight:0,h=p?p.clientWidth:0,x=N===i?Math.max(0,_-y):0;N=i,_=Math.abs(i?e-x:e+x),y=m=0,clearTimeout(g);!function e(){if(y<_){var l=R.fixedType;m=Math.max(5,Math.floor(1.5*m)),_<(y+=m)&&(m-=y-_);var t=v.scrollTop,o=v.clientHeight,r=v.scrollHeight,a=t+m*(i?-1:1);v.scrollTop=a,c&&(c.scrollTop=a),d&&(d.scrollTop=a),(i?a<r-o:0<=a)&&(g=setTimeout(e,10)),Oe.dispatchEvent("scroll",{type:renderType,fixed:l,scrollTop:v.scrollTop,scrollLeft:v.scrollLeft,bodyHeight:f,bodyWidth:h,isX:s,isY:u},n)}}()}(e,v,c,h,x),r&&Oe.triggerScrollYEvent(e))}};(0,_vue.onMounted)(function(){(0,_vue.nextTick)(function(){var e=R.fixedType,l=Ie.elemStore,t=(e||"main")+"-body-",o=k.value;l[t+"wrapper"]=k.value,l[t+"table"]=L.value,l[t+"colgroup"]=O.value,l[t+"list"]=q.value,l[t+"xSpace"]=U.value,l[t+"ySpace"]=Y.value,l[t+"emptyBlock"]=B.value,o.onscroll=r,o._onscroll=r})}),(0,_vue.onBeforeUnmount)(function(){var e=k.value;clearTimeout(g),e._onscroll=null,e.onscroll=null});return function(){var e,l=R.fixedColumn,t=R.fixedType,o=R.tableColumn,r=Re.keyboardConfig,a=Re.showOverflow,n=Re.spanMethod,i=Re.mouseConfig,s=Ee.tableData,u=Ee.mergeList,c=Ee.scrollXLoad,d=Ee.scrollYLoad,v=Ee.isAllOverflow,p=Ie.visibleColumn,f=b.slots,h=Me.value,x=S.value,g=C.value,_=T.value;if(t&&(o=c||d||(a?v:a)?u.length||n||r&&g.isMerge?p:l:p),f.empty)e=Oe.callSlot(f.empty,{$table:Oe});else{var m=x.name?_vXETable.VXETable.renderer.get(x.name):null,y=m?m.renderEmpty:null;e=y?y(x,{$table:Oe}):Re.emptyText||_conf.default.i18n("vxe.table.emptyText")}return(0,_vue.h)("div",__assign({ref:k,class:["vxe-table--body-wrapper",t?"fixed-"+t+"--wrapper":"body--wrapper"],xid:w},d&&"wheel"===h.mode?{onWheel:V}:{}),[t?(0,_vue.createCommentVNode)():(0,_vue.h)("div",{ref:U,class:"vxe-body--x-space"}),(0,_vue.h)("div",{ref:Y,class:"vxe-body--y-space"}),(0,_vue.h)("table",{ref:L,class:"vxe-table--body",xid:w,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("colgroup",{ref:O},o.map(function(e,l){return(0,_vue.h)("col",{name:e.id,key:l})})),(0,_vue.h)("tbody",{ref:q},function f(h,x,g,_,m){var y=Re.stripe,w=Re.rowKey,b=Re.highlightHoverRow,T=Re.rowClassName,S=Re.rowStyle,C=Re.showOverflow,L=Re.editConfig,O=Re.treeConfig,R=Ee.hasFixedColumn,E=Ee.treeExpandeds,I=Ee.scrollYLoad,$=Ee.editStore,M=Ee.rowExpandeds,H=Ee.expandColumn,D=Ee.selectRow,k=Ie.scrollYStore,q=ke.value,U=A.value,Y=De.value,B=$e.value,X=[];return _.forEach(function(t,o){var e={},r=o,a=r+1;I&&(a+=k.startIndex);var n=Oe.getVTRowIndex(t);r=Oe.getRowIndex(t),b&&(e.onMouseenter=function(e){Be()||Oe.triggerHoverEvent(e,{row:t,rowIndex:r})},e.onMouseleave=function(){Be()||Oe.clearHoverRow()});var i=(0,_util.getRowid)(Oe,t),l={$table:Oe,$seq:h,seq:a,rowid:i,fixed:g,type:renderType,level:x,row:t,rowIndex:r,$rowIndex:o,_rowIndex:n},s=!1;if(L&&(s=-1<Oe.findRowIndexOf($.insertList,t)),X.push((0,_vue.h)("tr",__assign({class:["vxe-body--row",{"row--stripe":y&&(Oe.getVTRowIndex(t)+1)%2==0,"is--new":s,"row--new":s&&(B.showStatus||B.showInsertStatus),"row--radio":U.highlight&&D===t,"row--checked":q.highlight&&Oe.isCheckedByCheckboxRow(t)},T?_xeUtils.default.isFunction(T)?T(l):T:""],rowid:i,style:S?_xeUtils.default.isFunction(S)?S(l):S:null,key:w||O?i:o},e),m.map(function(e,l){return j(h,a,i,g,x,t,r,o,n,e,l,m,_)}))),H&&M.length&&-1<Oe.findRowIndexOf(M,t)){var u=void 0;O&&(u={paddingLeft:x*Y.indent+30+"px"});var c=H.showOverflow,d=_xeUtils.default.isUndefined(c)||_xeUtils.default.isNull(c)?C:c,v={$table:Oe,$seq:h,seq:a,column:H,fixed:g,type:renderType,level:x,row:t,rowIndex:r,$rowIndex:o,_rowIndex:n};X.push((0,_vue.h)("tr",__assign({class:"vxe-body--expanded-row",key:"expand_"+i,style:S?_xeUtils.default.isFunction(S)?S(v):S:null},e),[(0,_vue.h)("td",{class:["vxe-body--expanded-column",{"fixed--hidden":g&&!R,"col--ellipsis":d}],colspan:m.length},[(0,_vue.h)("div",{class:"vxe-body--expanded-cell",style:u},[H.renderData(v)])])]))}if(O&&E.length){var p=t[Y.children];p&&p.length&&-1<Oe.findRowIndexOf(E,t)&&X.push.apply(X,f(h?h+"."+a:""+a,x+1,g,p,m))}}),X}("",0,t,s,o))]),(0,_vue.h)("div",{class:"vxe-table--checkbox-range"}),i&&_.area?(0,_vue.h)("div",{class:"vxe-table--cell-area"},[(0,_vue.h)("span",{class:"vxe-table--cell-main-area"},_.extension?[(0,_vue.h)("span",{class:"vxe-table--cell-main-area-btn",onMousedown:function(e){Oe.triggerCellExtendMousedownEvent(e,{$table:Oe,fixed:t,type:renderType})}})]:[]),(0,_vue.h)("span",{class:"vxe-table--cell-copy-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-extend-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-multi-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-active-area"})]):null,t?null:(0,_vue.h)("div",{class:"vxe-table--empty-block",ref:B},[(0,_vue.h)("div",{class:"vxe-table--empty-content"},e)])])}}});exports.default=_default;
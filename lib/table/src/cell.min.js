"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Cell=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=require("../../v-x-e-table"),_utils=require("../../tools/utils"),_dom=require("../../tools/dom"),_util=require("./util");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var l,r=1,n=arguments.length;r<n;r++)for(var t in l=arguments[r])Object.prototype.hasOwnProperty.call(l,t)&&(e[t]=l[t]);return e}).apply(this,arguments)};function renderHelpIcon(l){var r=l.$table,e=l.column.titleHelp;return e?[(0,_vue.h)("i",{class:["vxe-cell-help-icon",e.icon||_conf.default.icon.TABLE_HELP],onMouseenter:function(e){r.triggerHeaderHelpEvent(e,l)},onMouseleave:function(e){r.handleTargetLeaveEvent(e)}})]:[]}function renderTitleContent(l,e){var r=l.$table,n=l.column,t=r.props,a=r.internalData,o=r.getComputeMaps().computeTooltipOpts,c=t.showHeaderOverflow,i=n.type,d=n.showHeaderOverflow,s=o.value.showAll,u=_xeUtils.default.isUndefined(d)||_xeUtils.default.isNull(d)?c:d,v="title"===u,f=!0===u||"tooltip"===u,C={};return(v||f||s)&&(C.onMouseenter=function(e){a._isResize||(v?(0,_dom.updateCellTitle)(e.currentTarget,n):(f||s)&&r.triggerHeaderTooltipEvent(e,l))}),(f||s)&&(C.onMouseleave=function(e){a._isResize||(f||s)&&r.handleTargetLeaveEvent(e)}),["html"===i&&_xeUtils.default.isString(e)?(0,_vue.h)("span",__assign({class:"vxe-cell--title",innerHTML:e},C)):(0,_vue.h)("span",__assign({class:"vxe-cell--title"},C),e)]}function getFooterContent(e){var l=e.$table,r=e.column,n=e._columnIndex,t=e.items,a=r.slots,o=r.editRender,c=r.cellRender,i=o||c,d=a?a.footer:null;if(d)return l.callSlot(d,e);if(i){var s=_vXETable.VXETable.renderer.get(i.name);if(s&&s.renderFooter)return s.renderFooter(i,e)}return[(0,_utils.formatText)(t[n],1)]}function getDefaultCellLabel(e){var l=e.$table,r=e.row,n=e.column;return(0,_utils.formatText)(l.getCellLabel(r,n),1)}var Cell={createColumn:function(e,l){var r=l.type,n=l.sortable,t=l.filters,a=l.editRender,o=l.treeNode,c=e.props.editConfig,i=e.getComputeMaps(),d=i.computeEditOpts,s=i.computeCheckboxOpts.value,u=d.value,v={renderHeader:Cell.renderDefaultHeader,renderCell:o?Cell.renderTreeCell:Cell.renderDefaultCell,renderFooter:Cell.renderDefaultFooter};switch(r){case"seq":v.renderHeader=Cell.renderIndexHeader,v.renderCell=o?Cell.renderTreeIndexCell:Cell.renderIndexCell;break;case"radio":v.renderHeader=Cell.renderRadioHeader,v.renderCell=o?Cell.renderTreeRadioCell:Cell.renderRadioCell;break;case"checkbox":v.renderHeader=Cell.renderSelectionHeader,v.renderCell=s.checkField?o?Cell.renderTreeSelectionCellByProp:Cell.renderSelectionCellByProp:o?Cell.renderTreeSelectionCell:Cell.renderSelectionCell;break;case"expand":v.renderCell=Cell.renderExpandCell,v.renderData=Cell.renderExpandData;break;case"html":v.renderCell=o?Cell.renderTreeHTMLCell:Cell.renderHTMLCell,t&&n?v.renderHeader=Cell.renderSortAndFilterHeader:n?v.renderHeader=Cell.renderSortHeader:t&&(v.renderHeader=Cell.renderFilterHeader);break;default:c&&a?(v.renderHeader=Cell.renderEditHeader,v.renderCell="cell"===u.mode?o?Cell.renderTreeCellEdit:Cell.renderCellEdit:o?Cell.renderTreeRowEdit:Cell.renderRowEdit):t&&n?v.renderHeader=Cell.renderSortAndFilterHeader:n?v.renderHeader=Cell.renderSortHeader:t&&(v.renderHeader=Cell.renderFilterHeader)}return(0,_util.createColumn)(e,l,v)},renderHeaderTitle:function(e){var l=e.$table,r=e.column,n=r.slots,t=r.editRender,a=r.cellRender,o=t||a,c=n?n.header:null;if(c)return renderTitleContent(e,l.callSlot(c,e));if(o){var i=_vXETable.VXETable.renderer.get(o.name);if(i&&i.renderHeader)return renderTitleContent(e,i.renderHeader(o,e))}return renderTitleContent(e,(0,_utils.formatText)(r.getTitle(),1))},renderDefaultHeader:function(e){return renderHelpIcon(e).concat(Cell.renderHeaderTitle(e))},renderDefaultCell:function(e){var l=e.$table,r=e.row,n=e.column,t=n.slots,a=n.editRender,o=n.cellRender,c=a||o,i=t?t.default:null;if(i)return l.callSlot(i,e);if(c){var d=a?"renderCell":"renderDefault",s=_vXETable.VXETable.renderer.get(c.name),u=s?s[d]:null;if(u)return u(c,Object.assign({$type:a?"edit":"cell"},e))}var v=l.getCellLabel(r,n),f=a?a.placeholder:"";return[(0,_vue.h)("span",{class:"vxe-cell--label"},a&&(0,_utils.eqEmptyValue)(v)?[(0,_vue.h)("span",{class:"vxe-cell--placeholder"},(0,_utils.formatText)((0,_utils.getFuncText)(f),1))]:(0,_utils.formatText)(v,1))]},renderTreeCell:function(e){return Cell.renderTreeIcon(e,Cell.renderDefaultCell(e))},renderDefaultFooter:function(e){return[(0,_vue.h)("span",{class:"vxe-cell--item"},getFooterContent(e))]},renderTreeIcon:function(l,e){var r=l.$table,n=l.isHidden,t=r.reactData,a=r.getComputeMaps().computeTreeOpts,o=t.treeExpandeds,c=t.treeLazyLoadeds,i=a.value,d=l.row,s=l.column,u=l.level,v=s.slots,f=i.children,C=i.hasChild,_=i.indent,p=i.lazy,x=i.trigger,h=i.iconLoaded,b=i.showIcon,T=i.iconOpen,m=i.iconClose,g=d[f],E=v?v.icon:null,k=!1,H=!1,S=!1,R={};return E?r.callSlot(E,l):(n||(H=-1<r.findRowIndexOf(o,d),p&&(S=-1<r.findRowIndexOf(c,d),k=d[C])),x&&"default"!==x||(R.onClick=function(e){return r.triggerTreeExpandEvent(e,l)}),[(0,_vue.h)("div",{class:["vxe-cell--tree-node",{"is--active":H}],style:{paddingLeft:u*_+"px"}},[b&&(g&&g.length||k)?[(0,_vue.h)("div",__assign({class:"vxe-tree--btn-wrapper"},R),[(0,_vue.h)("i",{class:["vxe-tree--node-btn",S?h||_conf.default.icon.TABLE_TREE_LOADED:H?T||_conf.default.icon.TABLE_TREE_OPEN:m||_conf.default.icon.TABLE_TREE_CLOSE]})])]:null,(0,_vue.h)("div",{class:"vxe-tree-cell"},e)])])},renderIndexHeader:function(e){var l=e.$table,r=e.column,n=r.slots,t=n?n.header:null;return renderTitleContent(e,t?l.callSlot(t,e):(0,_utils.formatText)(r.getTitle(),1))},renderIndexCell:function(e){var l=e.$table,r=e.column,n=l.getComputeMaps().computeSeqOpts.value,t=r.slots,a=t?t.default:null;if(a)return l.callSlot(a,e);var o=e.$seq,c=e.seq,i=e.level,d=n.seqMethod;return[(0,_utils.formatText)(d?d(e):i?o+"."+c:(n.startIndex||0)+c,1)]},renderTreeIndexCell:function(e){return Cell.renderTreeIcon(e,Cell.renderIndexCell(e))},renderRadioHeader:function(e){var l=e.$table,r=e.column,n=r.slots,t=n?n.header:null,a=n?n.title:null;return renderTitleContent(e,t?l.callSlot(t,e):[(0,_vue.h)("span",{class:"vxe-radio--label"},a?l.callSlot(a,e):(0,_utils.formatText)(r.getTitle(),1))])},renderRadioCell:function(l){var e,r=l.$table,n=l.column,t=l.isHidden,a=r.reactData,o=r.getComputeMaps().computeRadioOpts,c=a.selectRow,i=o.value,d=n.slots,s=i.labelField,u=i.checkMethod,v=l.row,f=d?d.default:null,C=d?d.radio:null,_=v===c,p=!!u;t||(e={onClick:function(e){p||r.triggerRadioRowEvent(e,l)}},u&&(p=!u({row:v})));var x=__assign(__assign({},l),{checked:_,disabled:p});return C?r.callSlot(C,x):[(0,_vue.h)("span",__assign({class:["vxe-cell--radio",{"is--checked":_,"is--disabled":p}]},e),[(0,_vue.h)("span",{class:"vxe-radio--icon vxe-radio--checked-icon"}),(0,_vue.h)("span",{class:"vxe-radio--icon vxe-radio--unchecked-icon"})].concat(f||s?[(0,_vue.h)("span",{class:"vxe-radio--label"},f?r.callSlot(f,x):_xeUtils.default.get(v,s))]:[]))]},renderTreeRadioCell:function(e){return Cell.renderTreeIcon(e,Cell.renderRadioCell(e))},renderSelectionHeader:function(e){var l,r=e.$table,n=e.column,t=e.isHidden,a=r.reactData,o=r.getComputeMaps(),c=o.computeIsAllCheckboxDisabled,i=o.computeCheckboxOpts,d=a.isIndeterminate,s=a.isAllSelected,u=c.value,v=n.slots,f=v?v.header:null,C=v?v.title:null,_=i.value,p=n.getTitle(),x=!1;t||(x=!u&&s,l={onClick:function(e){u||r.triggerCheckAllEvent(e,!x)}});var h=__assign(__assign({},e),{checked:x,disabled:u,indeterminate:d});return f?renderTitleContent(h,r.callSlot(f,h)):(_.checkStrictly?_.showHeader:!1!==_.showHeader)?renderTitleContent(h,[(0,_vue.h)("span",__assign({class:["vxe-cell--checkbox",{"is--checked":x,"is--disabled":u,"is--indeterminate":d}],title:_conf.default.i18n("vxe.table.allTitle")},l),[(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"})].concat(C||p?[(0,_vue.h)("span",{class:"vxe-checkbox--label"},C?r.callSlot(C,h):p)]:[]))]):renderTitleContent(h,[(0,_vue.h)("span",{class:"vxe-checkbox--label"},C?r.callSlot(C,h):p)])},renderSelectionCell:function(l){var e,r=l.$table,n=l.row,t=l.column,a=l.isHidden,o=r.props,c=r.reactData,i=o.treeConfig,d=c.selection,s=c.treeIndeterminates,u=r.getComputeMaps().computeCheckboxOpts.value,v=u.labelField,f=u.checkMethod,C=t.slots,_=C?C.default:null,p=C?C.checkbox:null,x=!1,h=!1,b=!!f;a||(h=-1<r.findRowIndexOf(d,n),e={onClick:function(e){b||r.triggerCheckRowEvent(e,l,!h)}},f&&(b=!f({row:n})),i&&(x=-1<r.findRowIndexOf(s,n)));var T=__assign(__assign({},l),{checked:h,disabled:b,indeterminate:x});return p?r.callSlot(p,T):[(0,_vue.h)("span",__assign({class:["vxe-cell--checkbox",{"is--checked":h,"is--disabled":b,"is--indeterminate":x}]},e),[(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"})].concat(_||v?[(0,_vue.h)("span",{class:"vxe-checkbox--label"},_?r.callSlot(_,T):_xeUtils.default.get(n,v))]:[]))]},renderTreeSelectionCell:function(e){return Cell.renderTreeIcon(e,Cell.renderSelectionCell(e))},renderSelectionCellByProp:function(l){var e,r=l.$table,n=l.row,t=l.column,a=l.isHidden,o=r.props,c=r.reactData,i=o.treeConfig,d=c.treeIndeterminates,s=r.getComputeMaps().computeCheckboxOpts.value,u=s.labelField,v=s.checkField,f=s.halfField,C=s.checkMethod,_=t.slots,p=_?_.default:null,x=_?_.checkbox:null,h=!1,b=!1,T=!!C;a||(b=_xeUtils.default.get(n,v),e={onClick:function(e){T||r.triggerCheckRowEvent(e,l,!b)}},C&&(T=!C({row:n})),i&&(h=-1<r.findRowIndexOf(d,n)));var m=__assign(__assign({},l),{checked:b,disabled:T,indeterminate:h});return x?r.callSlot(x,m):[(0,_vue.h)("span",__assign({class:["vxe-cell--checkbox",{"is--checked":b,"is--disabled":T,"is--indeterminate":f&&!b?n[f]:h}]},e),[(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),(0,_vue.h)("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"})].concat(p||u?[(0,_vue.h)("span",{class:"vxe-checkbox--label"},p?r.callSlot(p,m):_xeUtils.default.get(n,u))]:[]))]},renderTreeSelectionCellByProp:function(e){return Cell.renderTreeIcon(e,Cell.renderSelectionCellByProp(e))},renderExpandCell:function(l){var r=l.$table,e=l.isHidden,n=l.row,t=l.column,a=r.reactData,o=a.rowExpandeds,c=a.expandLazyLoadeds,i=r.getComputeMaps().computeExpandOpts.value,d=i.lazy,s=i.labelField,u=i.iconLoaded,v=i.showIcon,f=i.iconOpen,C=i.iconClose,_=i.visibleMethod,p=t.slots,x=p?p.default:null,h=p?p.icon:null,b=!1,T=!1;return h?r.callSlot(h,l):(e||(b=-1<r.findRowIndexOf(o,l.row),d&&(T=-1<r.findRowIndexOf(c,n))),[!v||_&&!_(l)?null:(0,_vue.h)("span",{class:["vxe-table--expanded",{"is--active":b}],onClick:function(e){r.triggerRowExpandEvent(e,l)}},[(0,_vue.h)("i",{class:["vxe-table--expand-btn",T?u||_conf.default.icon.TABLE_EXPAND_LOADED:b?f||_conf.default.icon.TABLE_EXPAND_OPEN:C||_conf.default.icon.TABLE_EXPAND_CLOSE]})]),x||s?(0,_vue.h)("span",{class:"vxe-table--expand-label"},x?r.callSlot(x,l):_xeUtils.default.get(n,s)):null])},renderExpandData:function(e){var l=e.$table,r=e.column,n=r.slots,t=r.contentRender,a=n?n.content:null;if(a)return l.callSlot(a,e);if(t){var o=_vXETable.VXETable.renderer.get(t.name);if(o&&o.renderExpand)return o.renderExpand(t,e)}return[]},renderHTMLCell:function(e){var l=e.$table,r=e.column.slots,n=r?r.default:null;return n?l.callSlot(n,e):[(0,_vue.h)("span",{class:"vxe-cell--html",innerHTML:getDefaultCellLabel(e)})]},renderTreeHTMLCell:function(e){return Cell.renderTreeIcon(e,Cell.renderHTMLCell(e))},renderSortAndFilterHeader:function(e){return Cell.renderDefaultHeader(e).concat(Cell.renderSortIcon(e)).concat(Cell.renderFilterIcon(e))},renderSortHeader:function(e){return Cell.renderDefaultHeader(e).concat(Cell.renderSortIcon(e))},renderSortIcon:function(e){var l=e.$table,r=e.column,n=l.getComputeMaps().computeSortOpts.value,t=n.showIcon,a=n.iconAsc,o=n.iconDesc,c=r.order;return t?[(0,_vue.h)("span",{class:"vxe-cell--sort"},[(0,_vue.h)("i",{class:["vxe-sort--asc-btn",a||_conf.default.icon.TABLE_SORT_ASC,{"sort--active":"asc"===c}],title:_conf.default.i18n("vxe.table.sortAsc"),onClick:function(e){l.triggerSortEvent(e,r,"asc")}}),(0,_vue.h)("i",{class:["vxe-sort--desc-btn",o||_conf.default.icon.TABLE_SORT_DESC,{"sort--active":"desc"===c}],title:_conf.default.i18n("vxe.table.sortDesc"),onClick:function(e){l.triggerSortEvent(e,r,"desc")}})])]:[]},renderFilterHeader:function(e){return Cell.renderDefaultHeader(e).concat(Cell.renderFilterIcon(e))},renderFilterIcon:function(l){var r=l.$table,e=l.column,n=l.hasFilter,t=r.reactData.filterStore,a=r.getComputeMaps().computeFilterOpts.value,o=a.showIcon,c=a.iconNone,i=a.iconMatch;return o?[(0,_vue.h)("span",{class:["vxe-cell--filter",{"is--active":t.visible&&t.column===e}]},[(0,_vue.h)("i",{class:["vxe-filter--btn",n?i||_conf.default.icon.TABLE_FILTER_MATCH:c||_conf.default.icon.TABLE_FILTER_NONE],title:_conf.default.i18n("vxe.table.filter"),onClick:function(e){r.triggerFilterEvent(e,l.column,l)}})])]:[]},renderEditHeader:function(e){var l=e.$table,r=e.column,n=l.props,t=l.getComputeMaps().computeEditOpts,a=n.editConfig,o=n.editRules,c=t.value,i=r.sortable,d=r.filters,s=r.editRender,u=!1;if(o){var v=_xeUtils.default.get(o,e.column.property);v&&(u=v.some(function(e){return e.required}))}return((0,_utils.isEnableConf)(a)?[u&&c.showAsterisk?(0,_vue.h)("i",{class:"vxe-cell--required-icon"}):null,(0,_utils.isEnableConf)(s)&&c.showIcon?(0,_vue.h)("i",{class:["vxe-cell--edit-icon",c.icon||_conf.default.icon.TABLE_EDIT]}):null]:[]).concat(Cell.renderDefaultHeader(e)).concat(i?Cell.renderSortIcon(e):[]).concat(d?Cell.renderFilterIcon(e):[])},renderRowEdit:function(e){var l=e.$table,r=e.column,n=l.reactData.editStore.actived,t=r.editRender;return Cell.runRenderer(e,(0,_utils.isEnableConf)(t)&&n&&n.row===e.row)},renderTreeRowEdit:function(e){return Cell.renderTreeIcon(e,Cell.renderRowEdit(e))},renderCellEdit:function(e){var l=e.$table,r=e.column,n=l.reactData.editStore.actived,t=r.editRender;return Cell.runRenderer(e,(0,_utils.isEnableConf)(t)&&n&&n.row===e.row&&n.column===e.column)},renderTreeCellEdit:function(e){return Cell.renderTreeIcon(e,Cell.renderCellEdit(e))},runRenderer:function(e,l){var r=e.$table,n=e.column,t=n.slots,a=n.editRender,o=n.formatter,c=t?t.default:null,i=t?t.edit:null,d=_vXETable.VXETable.renderer.get(a.name);return l?i?r.callSlot(i,e):d&&d.renderEdit?d.renderEdit(a,Object.assign({$type:"edit"},e)):[]:c?r.callSlot(c,e):o?[(0,_vue.h)("span",{class:"vxe-cell--label"},getDefaultCellLabel(e))]:Cell.renderDefaultCell(e)}},_default=exports.Cell=Cell;exports.default=_default;